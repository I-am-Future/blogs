<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/time-machine.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Future&#39;s blog">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="Future&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Future">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Future's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Future's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/13/welcome-page/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/13/welcome-page/" class="post-title-link" itemprop="url">Welcome to my Blog!</a>
        </h2>

        <div class="post-meta">
          
              <i class="fa fa-thumbtack"></i>
              <font color=7D26CD>Pinned</font>
              <span class="post-meta-divider">|</span>
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-09-13 13:34:23 / Modified: 13:47:03" itemprop="dateCreated datePublished" datetime="2023-09-13T13:34:23+08:00">2023-09-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Hello! 你好！</p>
<p>I’m @<a target="_blank" rel="noopener" href="https://github.com/I-am-Future">I-am-Future</a>, currently I am an undergraduate of computer science in CUHK-Shenzhen, interested in deep learning, robotics and computer vision. I love computer science, from low level microprocessors and assembly to high level applications, such as deep learning, computer graphics, etc. </p>
<p>Welcome to my blog! This blog is established on Mar. 21st, 2023. The aim is to build such a blog website which can be used to share my programming &#x2F; other knowledges. There are few categories in my blog, you can access them from the button at the top. These include:</p>
<ul>
<li>Series of knowledge (such as “Deep Learning”, “Pandas-SQL”)</li>
<li>Some problems I had met (“Problem Solving”)</li>
<li>Some package&#x2F;tools Quick Reference Handbook (“QRH”), etc.</li>
</ul>
<p>Also, you can use the search button at the top for the topics you like. All of them are very interesting. </p>
<p>Enjoy them!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/05/27/Compress-Native-System-Screen-Recording/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/05/27/Compress-Native-System-Screen-Recording/" class="post-title-link" itemprop="url">Compress Native System Screen Recording</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-05-27 16:46:07" itemprop="dateCreated datePublished" datetime="2024-05-27T16:46:07+08:00">2024-05-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-05-30 00:51:46" itemprop="dateModified" datetime="2024-05-30T00:51:46+08:00">2024-05-30</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Compress-Native-System-Screen-Recording"><a href="#Compress-Native-System-Screen-Recording" class="headerlink" title="Compress Native System Screen Recording"></a>Compress Native System Screen Recording</h1><h2 id="Problem-Statement"><a href="#Problem-Statement" class="headerlink" title="Problem Statement"></a>Problem Statement</h2><p>The native screen recording in Windows&#x2F;MacOS has very high quality, so that the video are usually too large to share with others. For example, a 2-hour screen recording on MacOS consumes 14 GB memory!</p>
<p>However, we noticed that the screen recording from zoom&#x2F;tencent meeting is very light-weight. A 2-hour screen recording costs only hundreds of megabytes!</p>
<p>So, if we want to share the screen recording from native system to others, can we convert it to the one like the zoom? It has smaller file size and the video is quality is enough for watching.</p>
<h2 id="Observation-Analysis"><a href="#Observation-Analysis" class="headerlink" title="Observation &amp; Analysis"></a>Observation &amp; Analysis</h2><p>We get two videos, from Tencent Meeting (<code>tencent.mp4</code>) and Windows Native recording (<code>windows.mp4</code>) respectively:</p>
<table>
<thead>
<tr>
<th></th>
<th><code>tencent.mp4</code></th>
<th><code>windows.mp4</code></th>
</tr>
</thead>
<tbody><tr>
<td>Duration</td>
<td>6.7s</td>
<td>11.6s</td>
</tr>
<tr>
<td>File Size</td>
<td>261KB</td>
<td>11675KB</td>
</tr>
</tbody></table>
<p>We found that the size of <code>tencent.mp4</code> is far smaller (~20x) than the <code>windows.mp4</code>! Let’s analysis some details by the <code>ffprobe</code> provided by <code>ffmpeg</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description: Get the information of the video file using ffprobe</span></span><br><span class="line">ffprobe -v error -show_format -show_streams tencent.mp4</span><br><span class="line"></span><br><span class="line">ffprobe -v error -show_format -show_streams windows.mp4</span><br></pre></td></tr></table></figure>

<p>And here are some key observations comparison:</p>
<ol>
<li><strong>Codec Profile</strong>:<ul>
<li><code>tencent.mp4</code> uses the <strong>H.264 High Profile, which is suitable for high resolution and high compression efficiency.</strong></li>
<li><code>windows.mp4</code> uses the H.264 Main Profile, which typically has slightly lower compression efficiency compared to the High Profile.</li>
</ul>
</li>
<li><strong>Frame Rate</strong>:<ul>
<li><code>tencent.mp4</code> has a <strong>relatively low frame rate (approximately 15 fps), which helps to reduce file size.</strong></li>
<li><code>windows.mp4</code> has a higher frame rate (60 fps), which significantly increases the file size.</li>
</ul>
</li>
<li><strong>Bit Rate</strong>:<ul>
<li><code>tencent.mp4</code> has a <strong>very low bit rate (184243 bps), which greatly reduces file size but may affect video quality.</strong></li>
<li><code>windows.mp4</code> has a very high bit rate (7457076 bps), which ensures higher video quality but also results in a much larger file size.</li>
</ul>
</li>
<li><strong>Audio Settings</strong>:<ul>
<li><code>tencent.mp4</code> has <strong>mono audio and a lower sampling rate (32000 Hz), which helps to reduce file size.</strong></li>
<li><code>windows.mp4</code> has stereo audio and a higher sampling rate (48000 Hz), which increases file size.</li>
</ul>
</li>
</ol>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>From the analysis above, we come up the plan to reduce the video file size. We use <code>ffmpeg</code> to convert the videos. The following Python script helps making the <code>ffmpeg</code> commands:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Description: This script compresses a video file using ffmpeg with some preset parameters. </span></span><br><span class="line"><span class="keyword">import</span> os, pyperclip</span><br><span class="line"></span><br><span class="line">input_file = <span class="string">&#x27;input.mp4&#x27;</span></span><br><span class="line">output_file = <span class="string">&#x27;compressed_output.mp4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># H264 (libx264) encoder</span></span><br><span class="line">profile = <span class="string">&#x27;high&#x27;</span>  <span class="comment"># H.264 encoding profile (e.g., &#x27;high&#x27;, &#x27;main&#x27;, &#x27;baseline&#x27;)</span></span><br><span class="line">crf = <span class="number">23</span>  <span class="comment"># Constant Rate Factor, the lower the value, the higher the quality (range: 0-51)</span></span><br><span class="line">bitrate = <span class="string">&#x27;184k&#x27;</span>  <span class="comment"># Video bitrate (e.g., &#x27;500k&#x27;, &#x27;1000k&#x27;)</span></span><br><span class="line">framerate = <span class="number">15</span>  <span class="comment"># Frame rate (fps)</span></span><br><span class="line">vcodec = <span class="string">&#x27;libx264&#x27;</span>  <span class="comment"># Video codec (e.g., &#x27;libx264&#x27;, &#x27;libx265&#x27;)</span></span><br><span class="line"></span><br><span class="line">cmd = <span class="string">f&#x27;ffmpeg -i <span class="subst">&#123;input_file&#125;</span> -vcodec <span class="subst">&#123;vcodec&#125;</span> -profile:v <span class="subst">&#123;profile&#125;</span> -crf <span class="subst">&#123;crf&#125;</span> &#x27;</span> \</span><br><span class="line">      <span class="string">f&#x27;-preset fast -b:v <span class="subst">&#123;bitrate&#125;</span> -r <span class="subst">&#123;framerate&#125;</span> -pix_fmt yuv420p -acodec aac &#x27;</span> \</span><br><span class="line">      <span class="string">f&#x27;-b:a 128k -ar 32000 -ac 1 <span class="subst">&#123;output_file&#125;</span>&#x27;</span></span><br><span class="line"></span><br><span class="line">pyperclip.copy(cmd)</span><br><span class="line"><span class="built_in">print</span>(cmd)</span><br><span class="line">os.system(cmd)</span><br></pre></td></tr></table></figure>

<p>The output command example:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -vcodec libx264 -profile:v high -crf 23 -preset fast -b:v 184k -r 15 -pix_fmt yuv420p -acodec aac -b:a 128k -ar 32000 -ac 1 compressed_output.mp4</span><br></pre></td></tr></table></figure>

<p>To convert the file, we apply the high profile, a low crf, a low bitrate and framerate. You may export the video and check whether the video is over-compressed. </p>
<p><strong>Apple Silicon Acceleration</strong></p>
<p>For Apple Silicon users, we may apply the Apple’s own H264 encoding library for acceleration. The command may look like this:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Apple&#x27;s H264 encoder</span></span><br><span class="line">framerate = <span class="number">15</span>  <span class="comment"># Frame rate (fps)</span></span><br><span class="line">quality = <span class="number">10</span>  <span class="comment"># Quality</span></span><br><span class="line">cmd = <span class="string">f&#x27;ffmpeg -i <span class="subst">&#123;input_file&#125;</span> -vf &quot;scale=1920:-2,fps=<span class="subst">&#123;framerate&#125;</span>&quot; -c:v h264_videotoolbox &#x27;</span> \</span><br><span class="line">      <span class="string">f&#x27;-q:v <span class="subst">&#123;quality&#125;</span> -acodec copy &#x27;</span> \</span><br><span class="line">      <span class="string">f&#x27;<span class="subst">&#123;output_file&#125;</span>&#x27;</span></span><br></pre></td></tr></table></figure>
<p>The output command example:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i input.mp4 -vf <span class="string">&quot;scale=1920:-2,fps=15&quot;</span> -c:v h264_videotoolbox -q:v 10 -acodec copy compressed_output.mp4</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/02/01/Isaac-Gym-Installation-with-Troubleshooting/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/02/01/Isaac-Gym-Installation-with-Troubleshooting/" class="post-title-link" itemprop="url">Isaac Gym Installation with Troubleshooting</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2024-02-01 16:52:02 / Modified: 20:57:44" itemprop="dateCreated datePublished" datetime="2024-02-01T16:52:02+08:00">2024-02-01</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This blog is used to record my experience in installing Isaac Gym environment on the Linux Server. I’ll also write down all problems I met with troubleshooting.</p>
<h1 id="Prerequisite"><a href="#Prerequisite" class="headerlink" title="Prerequisite"></a>Prerequisite</h1><p>The followings are requirements provided by the project pages:</p>
<blockquote>
<p>Ubuntu 18.04, or 20.04.<br>Python 3.6, 3.7, or 3.8<br>Minimum recommended NVIDIA driver version: 470.74 (470 or above required)<br>Minimum required hardware: NVIDIA Pascal or later GPU with at least 8gb of VRAM</p>
</blockquote>
<div class="table-container">
<table>
<thead>
<tr>
<th>Possible Problems</th>
</tr>
</thead>
<tbody>
<tr>
<td>Don’t use WSL (Windows Subsystem on Linux)!!! The Nvidia driver on WSL may not support Vulkan well thus causing failure!</td>
</tr>
</tbody>
</table>
</div>
<h1 id="Download-amp-Install"><a href="#Download-amp-Install" class="headerlink" title="Download &amp; Install"></a>Download &amp; Install</h1><ol>
<li>Register and download from <a target="_blank" rel="noopener" href="https://developer.nvidia.com/isaac-gym/">https://developer.nvidia.com/isaac-gym/</a>. Press “join now” first, and then fill the form, and finally you are ready to download it.</li>
</ol>
<p><img src="/2024/02/01/Isaac-Gym-Installation-with-Troubleshooting/download.png" alt="download" style="zoom:50%;"></p>
<ol>
<li>Put the download file, probably named <code>IsaacGym_Preview_4_Package.tar.gz</code> on a proper folder. Then unzip it:</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf IsaacGym_Preview_4_Package.tar.gz</span><br></pre></td></tr></table></figure>
<ol>
<li>Go to the unzipped folder, and execute the <code>create_conda_env_rlgpu.sh</code>. This would automatically create a new environment, installed with all packages. </li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./create_conda_env_rlgpu.sh</span><br></pre></td></tr></table></figure>
<div class="table-container">
<table>
<thead>
<tr>
<th>Possible Problems</th>
</tr>
</thead>
<tbody>
<tr>
<td>The shell may stuck at “Solving…” stage. In that case, please follow step 4 below.</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><strong>[Alternative ways for step 3]</strong> If step 3 failed, consider the following method:</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create an env manually.</span></span><br><span class="line">conda create -n rlgpu python=3.8</span><br><span class="line"></span><br><span class="line"><span class="comment"># Go the the subdirectory,</span></span><br><span class="line"><span class="built_in">cd</span> python/</span><br><span class="line"></span><br><span class="line"><span class="comment"># Install manually.</span></span><br><span class="line">pip install -e .</span><br></pre></td></tr></table></figure>
<p>The above code would also install the <code>isaacgym</code>, with necessary dependencies (<code>pytorch</code>, <code>numpy</code>, etc.)</p>
<p>As in my machine, installing with latest PyTorch (<code>2.2.0</code>) and CUDA (<code>12.1</code>) is fine. It doesn’t require a former version.</p>
<h1 id="Test-demo"><a href="#Test-demo" class="headerlink" title="Test demo"></a>Test demo</h1><p>To run the test demo, cd to <code>python/examples</code>, and run:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python joint_monkey.py</span><br></pre></td></tr></table></figure>
<hr>
<div class="table-container">
<table>
<thead>
<tr>
<th>Possible Problem 1</th>
</tr>
</thead>
<tbody>
<tr>
<td>When importing <code>isaacgym</code>, returns error <code>ImportError: libpython3.8.so.1.0: cannot open shared object file: No such file or directory</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Solution 1:</strong> This is because the module failed to locate the static link library. We can add the corresponding path to the <code>LD_LIBRARY_PATH</code> so that the python could locate the library. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># in ~/.bashrc</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/&lt;miniconda_root&gt;/envs/&lt;env_name&gt;/lib:<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure>
<hr>
<div class="table-container">
<table>
<thead>
<tr>
<th>Possible Problem 2</th>
</tr>
</thead>
<tbody>
<tr>
<td>After executing <code>python joint_monkey.py</code>, it returns error <code>[Error] [carb.windowing-glfw.plugin] GLFW initialization failed.</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Solution 2:</strong> The test programs requires GUI. In the headless server, you may use <code>X11 forwarding</code> (e.g., MobaXterm) or <code>xvfb</code> virtual screen.</p>
<hr>
<div class="table-container">
<table>
<thead>
<tr>
<th>Possible Problem 3</th>
</tr>
</thead>
<tbody>
<tr>
<td>After executing <code>python joint_monkey.py</code>, it returns error <code>Segment Fault</code></td>
</tr>
</tbody>
</table>
</div>
<p><strong>Solution 3:</strong> There are no direct solutions on the Internet. After my experience, I can give you some possible reasons.</p>
<ul>
<li>Newer PyTorch, CUDA version: It should not be a big problem. As for me, I am using PyTorch (<code>2.2.0</code>) and CUDA (<code>12.1</code>), the program stills works!</li>
<li>Don’t use WSL: By 2/1/2024, the Vulkan has not fully supported on WSL. Therefore, the program may occur such problems. Use Linux machine instead.</li>
<li>Vulkan Installation: Please make sure the vulkan works fine on the server. You may visit <a target="_blank" rel="noopener" href="https://forums.developer.nvidia.com/t/cannot-run-the-examples/165180/3">here</a> for further information.</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/01/28/Learn-PyTorch-Lightning-with-Example-Codes/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/01/28/Learn-PyTorch-Lightning-with-Example-Codes/" class="post-title-link" itemprop="url">Learn PyTorch-Lightning with Example Codes</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2024-01-28 22:38:31" itemprop="dateCreated datePublished" datetime="2024-01-28T22:38:31+08:00">2024-01-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-15 19:50:05" itemprop="dateModified" datetime="2024-02-15T19:50:05+08:00">2024-02-15</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In this blog, we’ll learn <code>pytorch-lightning</code> framework with some simple example codes. I believe the code will significantly help you understand it. The official doc is at <a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/stable/">here</a>.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Before everything starts:</span></span><br><span class="line"><span class="keyword">import</span> pytorch_lightning <span class="keyword">as</span> pl</span><br></pre></td></tr></table></figure>

<p>To train a deep learning model, we need to code the following components: data, model, training&amp;testing procedures, and hyper-parameter configs. In <code>pytorch-lightning</code>, we have different classes handling them.</p>
<ul>
<li>Data: we can define a subclass of <code>pl.LightningDataModule</code> to implement procedures that initialize the <code>Dataset</code> and <code>DataLoader</code>. </li>
<li>Model: implement the model just like what you did without <code>pytorch-lightning</code> – a subclass of <code>nn.Module</code>. </li>
<li>Training &amp; Testing procedures: we can define a subclass of <code>pl.LightningModule</code> to implement the procedures.</li>
<li>Configs (<code>pytorch-lightning</code> have utilities for CLI arguments. But here we use another package called <code>configargparse</code>, which support both config file and CLI arguments)</li>
</ul>
<h2 id="1-Data"><a href="#1-Data" class="headerlink" title="1. Data"></a>1. Data</h2><p>We can define a <code>pl.LightningDataModule</code> which implements procedures to initialize the <code>Dataset</code> and <code>DataLoader</code>. </p>
<p>Main components of <code>pl.LightningDataModule</code>:</p>
<ul>
<li><code>__init__()</code>: <strong>The constructor.</strong> You can save some configurations (hyper-parameters) to the class here.</li>
<li><code>setup()</code>: <strong>Will be called before fit(), validate(), test(), and predict().</strong> You can initialize the datasets as class attributes here. Note that it has an argument <code>stage</code>, to indicate what stage is it (Because we may create different datasets for different stages). </li>
<li><code>prepare_data()</code>: <strong>Will be called only on Master process.</strong> In distribute training, <code>setup()</code> would be called on all processes. If you only want to only do one thing (e.g., downloading data), please implement it in the <code>prepare_data()</code>. </li>
<li><code>train_dataloader()</code>, <code>val_dataloader()</code>, <code>test_dataloader()</code>, <code>predict_dataloader()</code>. <strong>Will be called during the corresponding phase to get the DataLoader.</strong> It should return a <code>DataLoader</code> for that stage.</li>
</ul>
<p>Here’s an Example. You can check detailed descriptions of each function at the function docstring:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># DataModule</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyDataModule</span>(pl.LightningDataModule):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, data_dir=<span class="string">&#x27;./&#x27;</span>, batch_size=<span class="number">32</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initializes the data module with the some given config arguments.</span></span><br><span class="line"><span class="string">        This constructor sets up the initial configurations like data directory, </span></span><br><span class="line"><span class="string">        batch size, and transformations to be applied to the data.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Called when an instance of MyDataModule is created.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.data_dir = data_dir</span><br><span class="line">        self.batch_size = batch_size</span><br><span class="line">        self.transform = transforms.Compose([</span><br><span class="line">            transforms.ToTensor(),</span><br><span class="line">            transforms.Normalize((<span class="number">0.5</span>,), (<span class="number">0.5</span>,))</span><br><span class="line">        ])</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">setup</span>(<span class="params">self, stage=<span class="literal">None</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Prepares the data for use. It is automatically called at the beginning of fit, </span></span><br><span class="line"><span class="string">        validate, test, and predict, or when manually calling `trainer.setup`. This method </span></span><br><span class="line"><span class="string">        is responsible for setting up internal datasets (e.g., splitting the dataset into</span></span><br><span class="line"><span class="string">        training, validation, and testing sets, etc.)</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        `stage` can be used to differentiate between fit, validate, and test stages.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># Assign train/val datasets for use in dataloaders</span></span><br><span class="line">        <span class="keyword">if</span> stage == <span class="string">&quot;fit&quot;</span>:</span><br><span class="line">            mnist_full = datasets.MNIST(self.data_dir, train=<span class="literal">True</span>, transform=self.transform)</span><br><span class="line">            self.mnist_train, self.mnist_val = random_split(</span><br><span class="line">                mnist_full, [<span class="number">55000</span>, <span class="number">5000</span>], generator=torch.Generator().manual_seed(<span class="number">42</span>)</span><br><span class="line">            )</span><br><span class="line">    </span><br><span class="line">        <span class="comment"># Assign test dataset for use in dataloader(s)</span></span><br><span class="line">        <span class="keyword">if</span> stage == <span class="string">&quot;test&quot;</span>:</span><br><span class="line">            self.mnist_test = datasets.MNIST(self.data_dir, train=<span class="literal">False</span>, transform=self.transform)</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> stage == <span class="string">&quot;predict&quot;</span>:</span><br><span class="line">            self.mnist_predict = datasets.MNIST(self.data_dir, train=<span class="literal">False</span>, transform=self.transform)</span><br><span class="line">            </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">train_dataloader</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Creates and returns the DataLoader for the training dataset. This method is used to </span></span><br><span class="line"><span class="string">        load the training data and is automatically called during the training phase.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        Returns a DataLoader instance for the training data.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> DataLoader(self.mnist_train, batch_size=self.batch_size)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">val_dataloader</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Creates and returns the DataLoader for the validation dataset. This method is used to </span></span><br><span class="line"><span class="string">        load the validation data and is automatically called during the validation phase.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        Returns a DataLoader instance for the validation data.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> DataLoader(self.mnist_val, batch_size=self.batch_size, shuffle=<span class="literal">False</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_dataloader</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Creates and returns the DataLoader for the testing dataset. This method is used to </span></span><br><span class="line"><span class="string">        load the test data and is automatically called during the testing phase.</span></span><br><span class="line"><span class="string">    </span></span><br><span class="line"><span class="string">        Returns a DataLoader instance for the test data.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> DataLoader(self.mnist_test, batch_size=self.batch_size, shuffle=<span class="literal">False</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="2-Model"><a href="#2-Model" class="headerlink" title="2. Model"></a>2. Model</h2><p>You may directly implement the model in <code>pl.LightningModule</code>, but for clarity, I recommend you to implement your model as a separate <code>nn.Module</code> subclass, and then create the instances in the <code>pl.LightningModule</code>.  </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># You can do like this...</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLightningModule</span>(pl.LightningModule):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, hidden_dim=<span class="number">64</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.layer1 = torch.nn.Linear(<span class="number">28</span> * <span class="number">28</span>, self.hidden_dim)</span><br><span class="line">        self.layer2 = torch.nn.Linear(self.hidden_dim, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        x = torch.relu(self.layer1(x))</span><br><span class="line">        x = self.layer2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># But I recommend you to do like this:</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span>(nn.Module):</span><br><span class="line">	......</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyLightningModule</span>(pl.LightningModule):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, hidden_dim=<span class="number">64</span></span>):</span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.model = Model(hidden_dim)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="keyword">return</span> self.model(x)</span><br></pre></td></tr></table></figure>





<h2 id="3-Training-Testing-procedures"><a href="#3-Training-Testing-procedures" class="headerlink" title="3. Training &amp; Testing procedures"></a>3. Training &amp; Testing procedures</h2><p>We can define a <code>pl.LightningModule</code> which implements procedures for training, validating, testing and predicting. </p>
<p>Main components of <code>pl.LightningModule</code>:</p>
<ul>
<li><code>__init__()</code>: <strong>The constructor.</strong> You can save some configurations (hyper-parameters) to the class here.</li>
<li><code>forward()</code>: <strong>Make it behave like a <code>nn.Module</code>.</strong> You can implement the forward procedures here (See Sec. 2 for the example).</li>
<li><code>configure_optimizers()</code>: <strong>Defines the training optimizers.</strong> See <a target="_blank" rel="noopener" href="https://lightning.ai/docs/pytorch/stable/common/lightning_module.html#configure-optimizers">here</a> for some advanced usage.</li>
<li><code>train_step()</code>, <code>validation_step()</code>, <code>test_step()</code>, <code>predict_step()</code>: <strong>Will be called during the corresponding phase, to perform operations for a batch.</strong> It has an argument <code>batch_idx</code>, which indicates the batch index of current epoch. <strong>The <code>train_step()</code> should return the loss (a scalar or a dict)</strong>, and the module will automatically perform backward propagation.</li>
<li><code>on_train_epoch_start()</code>, <code>on_train_epoch_end()</code>, <code>on_XXX_epoch_start()</code>, <code>on_XXX_epoch_end()</code>: <strong>Will be called at the corresponding start&#x2F;end point.</strong> You can perform some epoch-level operations here. (See below example, where we collect all training batch losses to calculate the average loss on an epoch)</li>
<li>Use <code>self.log(tag, value)</code> to log the batch’s “tag” indicator with value “value” to the tensorboard &#x2F; log file.</li>
</ul>
<p>Here’s an Example. You can check detailed descriptions of each function at the function docstring:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyLightningModule</span>(pl.LightningModule):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self, hidden_dim=<span class="number">64</span></span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Initializes the LightningModule with two linear layers. This constructor </span></span><br><span class="line"><span class="string">        sets up the neural network architecture for the module.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Called when an instance of MyLightningModule is created.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__()</span><br><span class="line">        self.hidden_dim = hidden_dim</span><br><span class="line">        self.layer1 = torch.nn.Linear(<span class="number">28</span> * <span class="number">28</span>, self.hidden_dim)</span><br><span class="line">        self.layer2 = torch.nn.Linear(self.hidden_dim, <span class="number">10</span>)</span><br><span class="line">        self.training_results = [] <span class="comment"># To store training loss in each epoch</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self, x</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Defines the forward pass of the model. It is automatically called when </span></span><br><span class="line"><span class="string">        the model is used to make predictions.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#x27;x&#x27; is the input data. The method reshapes the input, applies a ReLU </span></span><br><span class="line"><span class="string">        activation after the first linear layer, and then passes it through the </span></span><br><span class="line"><span class="string">        second linear layer.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        x = x.view(x.size(<span class="number">0</span>), -<span class="number">1</span>)</span><br><span class="line">        x = torch.relu(self.layer1(x))</span><br><span class="line">        x = self.layer2(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">training_step</span>(<span class="params">self, batch, batch_idx</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Defines a single step in the training loop. It is automatically called for each </span></span><br><span class="line"><span class="string">        batch of data during training.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        &#x27;batch&#x27; contains the input data and labels, and &#x27;batch_idx&#x27; is the index of </span></span><br><span class="line"><span class="string">        the current batch. The method computes the model&#x27;s loss using cross-entropy.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        x, y = batch</span><br><span class="line">        logits = self(x)</span><br><span class="line">        loss = F.cross_entropy(logits, y)</span><br><span class="line">        self.log(<span class="string">&#x27;train_loss&#x27;</span>, loss)</span><br><span class="line">        self.training_results.append(loss)</span><br><span class="line">        <span class="keyword">return</span> loss</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">validation_step</span>(<span class="params">self, batch, batch_idx</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">test_step</span>(<span class="params">self, batch, batch_idx</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">configure_optimizers</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Configures the optimizers used for training. This method is automatically </span></span><br><span class="line"><span class="string">        called to configure the optimization algorithm.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns an optimizer, in this case, Adam, with a set learning rate.</span></span><br><span class="line"><span class="string">        See advanced usage in official docs.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> torch.optim.Adam(self.parameters(), lr=<span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Epoch-wise procedures</span></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_train_epoch_start</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Called at the start of every training epoch. Can be used to perform </span></span><br><span class="line"><span class="string">        actions specific to the beginning of each training epoch.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Training Epoch Start&quot;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_train_epoch_end</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        Called at the end of every training epoch. Can be used to perform </span></span><br><span class="line"><span class="string">        actions specific to the end of each training epoch.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Training Epoch End&quot;</span>)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Training Loss: &quot;</span>, <span class="built_in">sum</span>(self.training_results) / <span class="built_in">len</span>(self.training_results))</span><br><span class="line">        self.training_results.clear()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_validation_epoch_start</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_validation_epoch_end</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_test_epoch_start</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_test_epoch_end</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_predict_epoch_start</span>(<span class="params">self</span>):</span><br><span class="line">        ...</span><br><span class="line"></span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">on_predict_epoch_end</span>(<span class="params">self</span>):</span><br><span class="line">		...</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/10/26/Network-Config-for-VirtualBox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/10/26/Network-Config-for-VirtualBox/" class="post-title-link" itemprop="url">Network Configuration for VirtualBox</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-10-26 11:42:58" itemprop="dateCreated datePublished" datetime="2023-10-26T11:42:58+08:00">2023-10-26</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-12-20 10:11:33" itemprop="dateModified" datetime="2023-12-20T10:11:33+08:00">2023-12-20</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In some cases, when we import VM into the “Oracle VM VirtualBox Manager”, the network is not well configured, and we cannot connect it by SSH&#x2F;other things on the host machine. The default network setting may looks like this:</p>
<ul>
<li>The Adapter 1 (an <code>NAT</code> adapter):</li>
</ul>
<img src="/2023/10/26/Network-Config-for-VirtualBox/Network-setting1.png" alt="Network-setting1" style="zoom: 50%;">

<ul>
<li>The Adapter 2-4 (Not Enabled):</li>
</ul>
<img src="/2023/10/26/Network-Config-for-VirtualBox/Network-setting2.png" alt="Network-setting2" style="zoom:50%;">

<ul>
<li>After typing <code>ip a</code> in the terminal of the VM (assume it is a Linux machine), the result looks like below:</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:b3:8d:9b brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute enp0s3</span><br><span class="line">       valid_lft 86376sec preferred_lft 86376sec</span><br><span class="line">    inet6 fe80::6dea:8795:c7b1:a1a5/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>There are no available network adapter to the host. </p>
<h2 id="Method-1-By-Host-only-Adapter"><a href="#Method-1-By-Host-only-Adapter" class="headerlink" title="Method 1: By Host-only Adapter"></a>Method 1: By Host-only Adapter</h2><p><strong>Important!</strong></p>
<p><em>Pros:</em> It has a stable IP address, with all ports available. (e.g., setup different services on different ports, <code>22, 3389, ...</code>)</p>
<p><em>Cons:</em> The VM cannot be accessed from machine outside of the host (e.g., we cannot <code>ssh host_name@host_ip</code> to connect to the VM from other machines than host), unless you perform some port forwarding strategies on the host. </p>
<p><strong>Steps:</strong></p>
<p>To create a network connection from VM to host, we can set the Adapter 2 like below (Use a “Host-only Adapter”):</p>
<img src="/2023/10/26/Network-Config-for-VirtualBox/Network-setting3.png" alt="Network-setting3" style="zoom:50%;">

<p>After typing <code>ip a</code> in the terminal of the VM (assume it is a Linux machine) NOW, the result looks like below:</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:b3:8d:9b brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.2.15/24 brd 10.0.2.255 scope global dynamic noprefixroute enp0s3</span><br><span class="line">       valid_lft 86337sec preferred_lft 86337sec</span><br><span class="line">    inet6 fe80::6dea:8795:c7b1:a1a5/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: enp0s8: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link/ether 08:00:27:85:54:b0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.56.101/24 brd 192.168.56.255 scope global dynamic noprefixroute enp0s8</span><br><span class="line">       valid_lft 537sec preferred_lft 537sec</span><br><span class="line">    inet6 fe80::a598:692:2336:67d9/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>The third network adapter, with an ip address <code>192.168.56.101</code>, is the ip address of the “VirtualBox Host-Only Ethernet Adapter”. On the host machine, we can connect it by SSH fluently:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh ubuntu@192.168.56.101</span><br></pre></td></tr></table></figure>

<p>By so far, you can connect the machine via SSH well. You can also connect to other services by ip address <code>192.168.56.101</code> on the host machine. </p>
<h2 id="Method-2-Forward-Port-to-Host"><a href="#Method-2-Forward-Port-to-Host" class="headerlink" title="Method 2: Forward Port to Host"></a>Method 2: Forward Port to Host</h2><p><strong>Important!</strong></p>
<p>Pros: You can access the VM outside of the host machine, from a different machine. </p>
<p>Cons: Only forwarded ports available. Ports may conflict with others. </p>
<p><strong>Steps:</strong></p>
<p>Go to the Adapter 1, click the “Advanced” button to expand the menu. Click the “Port Forwarding”.</p>
<img src="/2023/10/26/Network-Config-for-VirtualBox/Network-setting4.png" alt="Network-setting4" style="zoom:50%;">

<p>In the “Port Forwarding Rules”, Set up new rules. The “Host Port” is the port number on the host machine. The “Guest Port” is the corresponding port number on the VM. In this example, I forwarded port 4016 on host to the port 22 on the VM.  </p>
<img src="/2023/10/26/Network-Config-for-VirtualBox/Network-setting5.png" alt="Network-setting5" style="zoom:50%;">

<p>After that, you can connect to the VM on the host machine. Type:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 4016 ubuntu@127.0.0.1</span><br></pre></td></tr></table></figure>

<p>You can also connect to the VM outside of the host machine. Assume in the local network, my ip address is <code>10.31.38.94</code>. So from the computer in the same local network, type:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 4016 ubuntu@10.31.38.94</span><br></pre></td></tr></table></figure>

<p>And everything should go fine. If something goes run, please check whether we have firewall permissions. If not, you can set a firewall rule for port <code>4016</code> (The port number you forwarded). </p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>You can setup both Method 1 &amp; Method 2!! Then you can experience all of these benefits (connect from other machines, all ports available on local machines, etc.) and avoid the disadvantages. </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/16/WSL-Container-ssh-Setup/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/16/WSL-Container-ssh-Setup/" class="post-title-link" itemprop="url">WSL-Container-ssh-Setup</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-16 10:44:16" itemprop="dateCreated datePublished" datetime="2023-09-16T10:44:16+08:00">2023-09-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-18 11:03:15" itemprop="dateModified" datetime="2023-09-18T11:03:15+08:00">2023-09-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>We usually use WSL and docker container for development. In most cases, when we install the WSL and container, we may need setup the SSH (secure shell) configuration by ourselves. This article shares my experience in setting up SSH in these environments. </p>
<h2 id="1-Install-Config"><a href="#1-Install-Config" class="headerlink" title="1. Install &amp; Config"></a>1. Install &amp; Config</h2><p><strong>Step 1: Install</strong> (Optional): If your the system has no ssh installed, you may use the package manager (e.g., <code>yum</code>, <code>apk</code>, <code>apt</code> based on which operating system you are using). E.g., </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu/Debian:</span></span><br><span class="line">sudo apt update</span><br><span class="line">sudo apt install openssh-server</span><br><span class="line"><span class="comment"># CentOS 7 and earlier:</span></span><br><span class="line">sudo yum install openssh-server</span><br><span class="line"><span class="comment"># CentOS 8 and later:</span></span><br><span class="line">sudo dnf install openssh-server</span><br><span class="line"><span class="comment"># Arch Linux:</span></span><br><span class="line">sudo pacman -S openssh</span><br><span class="line"><span class="comment"># Alpine Linux:</span></span><br><span class="line">sudo apk add openssh-server</span><br></pre></td></tr></table></figure>

<p><strong>Step 2: Configuring</strong>:</p>
<ol>
<li>set up keys for SSH. Run following codes.</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -q -t rsa -b 2048 -f /etc/ssh/ssh_host_rsa_key -N <span class="string">&#x27;&#x27;</span></span><br><span class="line">ssh-keygen -q -t ecdsa -f /etc/ssh/ssh_host_ecdsa_key -N <span class="string">&#x27;&#x27;</span></span><br><span class="line">ssh-keygen -t dsa -f /etc/ssh/ssh_host_ed25519_key -N <span class="string">&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>(Optional): If you haven’t set the password yet, set one first.</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd &lt;user_name&gt;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>set up configs in <code>sshd_config</code></li>
</ol>
<p>Use any text editor, like <code>vim</code>, to modify the <code>/etc/ssh/sshd_config</code> if needed. Some important configs are:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># indicates which port listening to</span></span><br><span class="line">Port 22</span><br><span class="line"><span class="comment"># Use public key authentication</span></span><br><span class="line">PubkeyAuthentication <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># Use password authentication</span></span><br><span class="line">PasswordAuthentication <span class="built_in">yes</span></span><br><span class="line"><span class="comment"># Use X11 forwarding to forward a display in the remote shell</span></span><br><span class="line">X11Forwarding <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Start the sshd service:</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Ubuntu/Debian:</span></span><br><span class="line">sudo systemctl start ssh</span><br><span class="line"><span class="comment"># CentOS:</span></span><br><span class="line">sudo systemctl start sshd</span><br><span class="line"><span class="comment"># Arch Linux:</span></span><br><span class="line">sudo systemctl start sshd</span><br><span class="line"><span class="comment"># Alpine Linux:</span></span><br><span class="line">sudo rc-service sshd start</span><br></pre></td></tr></table></figure>

<h2 id="2-Connect"><a href="#2-Connect" class="headerlink" title="2. Connect"></a>2. Connect</h2><p>Use <code>ssh -p &lt;port&gt; &lt;username&gt;@&lt;ip_address&gt;</code> to start a SSH connection. </p>
<h3 id="2-1-WSL"><a href="#2-1-WSL" class="headerlink" title="2.1 WSL"></a>2.1 WSL</h3><p><code>&lt;port&gt;</code>: Unless specified in the <code>/etc/ssh/sshd_config</code>, the default port number is 22.</p>
<p><code>username</code>: The one in the WSL. </p>
<p>The WSL is an independently installed operating system running on your machine, so it has a different ip address. To get the ip address, you can use the following command in the host’s powershell to get the <code>&lt;ip_address&gt;</code>:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wsl_ip</span> = (wsl hostname <span class="literal">-I</span>).trim()</span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;WSL Machine IP: &quot;</span><span class="string">&quot;<span class="variable">$wsl_ip</span>&quot;</span><span class="string">&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-2-Container"><a href="#2-2-Container" class="headerlink" title="2.2 Container"></a>2.2 Container</h3><p><code>&lt;port&gt;</code>: When configuring the container, we usually forward the container’s <code>22</code> port to one in the host machine. Use that port number at the host machine.</p>
<p><code>&lt;username&gt;</code>: Unless create other user, the container has only one default user, <code>root</code>.</p>
<p><code>ip_address</code>: Since we have port forwarding, the <code>ip_address</code> is the host machine, <code>127.0.0.1</code> (or equivalently, the ip address from command <code>ipconfig</code> (Windows), or <code>ifconfig/iwconfig</code> (Linux))</p>
<h2 id="3-Remote-Visiting"><a href="#3-Remote-Visiting" class="headerlink" title="3 Remote Visiting"></a>3 Remote Visiting</h2><p>In some cases, we may want to visit the WSL&#x2F;docker on this host machine from other machines in the same local network. </p>
<h3 id="3-1-WSL"><a href="#3-1-WSL" class="headerlink" title="3.1 WSL"></a>3.1 WSL</h3><p><strong>Host Port Forwarding.</strong> Since WSL behaves like a separate machine, it has its own ip address. We should perform port forwarding so that the remote connection to this host machine can be forwarded to the WSL. Run the following command to set port forwarding through Powershell in admin privilage.</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$wsl_ip</span> = (wsl hostname <span class="literal">-I</span>).trim()</span><br><span class="line"></span><br><span class="line"><span class="built_in">Write-Host</span> <span class="string">&quot;WSL Machine IP: &quot;</span><span class="string">&quot;<span class="variable">$wsl_ip</span>&quot;</span><span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">netsh interface portproxy add v4tov4 listenport=<span class="number">2222</span> connectport=<span class="number">22</span> connectaddress=<span class="variable">$wsl_ip</span></span><br></pre></td></tr></table></figure>

<p><strong>Firewall rules.</strong> We should set firewall permission rules, so that the connection would not be refused by the host machine. You may search additional online materials for how to allow TCP connection to the <code>&lt;listenport&gt;</code> you defined above, e.g., <a target="_blank" rel="noopener" href="https://supportcenter.lexisnexis.com/app/answers/answer_view/a_id/1081611/~/adding-exceptions-to-the-windows-firewall">here</a>. </p>
<p><strong>Connect.</strong> Then, we can access by <code>ssh -p 2222 &lt;wsl_username&gt;@&lt;host_ipaddr&gt;</code>. The <code>&lt;host_ipaddr</code> can be obtained by command <code>ipconfig</code> (Windows), or <code>ifconfig/iwconfig</code> (Linux). </p>
<p>Additional note: if something goes run, use <code>netsh interface portproxy reset</code> to reset the port forwarding. </p>
<h3 id="3-2-Container"><a href="#3-2-Container" class="headerlink" title="3.2 Container"></a>3.2 Container</h3><p>Connect by <code>ssh -p &lt;port&gt; &lt;wsl_username&gt;@&lt;host_ipaddr&gt;</code>, where:</p>
<p><code>&lt;port&gt;</code> is the forwarded port number, and </p>
<p><code>&lt;host_ipaddr&gt;</code> is the host’s ip address in the local network, obtained by command <code>ipconfig</code> (Windows), or <code>ifconfig/iwconfig</code> (Linux). </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/15/Docker-QRH/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/15/Docker-QRH/" class="post-title-link" itemprop="url">Docker Quick Reference</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-15 18:14:35" itemprop="dateCreated datePublished" datetime="2023-09-15T18:14:35+08:00">2023-09-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-16 10:35:39" itemprop="dateModified" datetime="2023-09-16T10:35:39+08:00">2023-09-16</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/QRH/" itemprop="url" rel="index"><span itemprop="name">QRH</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Images"><a href="#Images" class="headerlink" title="Images"></a>Images</h2><p><strong>Image:</strong> just like OS image, can be used to create a container. </p>
<p><strong>Create image</strong> by:</p>
<ol>
<li><code>.tar</code> file, with  <code>docker load -i &lt;tar_file&gt;</code> command.</li>
<li><code>Dockerfile</code> script, with <code>docker build -t</code> command.</li>
</ol>
<p><strong>List images:</strong> Use <code>docker images</code> to show all available images on the device.</p>
<h2 id="Container"><a href="#Container" class="headerlink" title="Container"></a>Container</h2><p><strong>Container:</strong> An instance running the OS. built from image. </p>
<p><strong>Create from image</strong> by <code>docker run</code> command. You can pass in some configuration. (Note some config are fixed after creation. Be careful!) Some common parameters are shown below:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d -p &lt;localport&gt;:&lt;dockerport&gt; --gpus all --name &lt;name&gt; --volume &lt;/path/host/directory&gt;:&lt;/path/container/directory&gt; &lt;IMAGE ID&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li><code>-d</code> means “detach”, running the docker container in the backend. </li>
<li><code>-p &lt;hostport&gt;:&lt;dockerport&gt;</code> means forward the docker’s port <code>&lt;dockerport&gt;</code> to the host machine’s port <code>&lt;hostport&gt;</code>. Usually, we forward <code>22</code> port from container to e.g., <code>2222</code> port in host for ssh connection.</li>
<li><code>--gpus all</code> means all host’s GPU are visible to the container.</li>
<li><code>--name &lt;name&gt;</code> indicates the name of the container. It will be shown in the <code>docker ps</code> and other places.</li>
<li><code>--volume &lt;/path/host/directory&gt;:&lt;/path/container/directory&gt;</code> indicates which host directory are shared with container’s directory, therefore, you can access it in both the container and host.</li>
<li><code>&lt;IMAGE ID&gt;</code> is the id of the image to be built.</li>
</ul>
<p><strong>List containers:</strong> Use <code>docker ps -a</code> to check status of all containers. Use <code>docker ps</code> to check all running containers. </p>
<p><strong>Three ways</strong> to interact with the container:</p>
<ol>
<li>Docker desktop’s shell</li>
<li><code>docker exec -it &lt;container id&gt; bash</code></li>
<li>SSH, if you have set so</li>
</ol>
<p><strong>Start the container:</strong> By <code>docker start &lt;CONTAINER ID&gt;</code>, or do it in docker desktop.</p>
<p><strong>Stop the container:</strong> By <code>docker stop &lt;CONTAINER ID&gt;</code>, or do it in docker desktop.</p>
<p><strong>More info:</strong> please see the official cheat sheet at <a target="_blank" rel="noopener" href="https://docs.docker.com/get-started/docker_cheatsheet.pdf">here</a>.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/07/Pandas-MySQL-Leetcode-Practice-Notes-3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/07/Pandas-MySQL-Leetcode-Practice-Notes-3/" class="post-title-link" itemprop="url">Pandas & MySQL Leetcode Practice Notes 3--Data Manipulation</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-07 22:46:16" itemprop="dateCreated datePublished" datetime="2023-09-07T22:46:16+08:00">2023-09-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-01-04 17:12:48" itemprop="dateModified" datetime="2024-01-04T17:12:48+08:00">2024-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Pandas-SQL/" itemprop="url" rel="index"><span itemprop="name">Pandas_SQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="3-Data-Manipulation"><a href="#3-Data-Manipulation" class="headerlink" title="3. Data Manipulation"></a>3. Data Manipulation</h1><p>In this article, we will discuss <strong>four traditional data manipulation problems</strong> in SQL &#x2F; Pandas. They are from</p>
<p><em>3.1:</em> <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/nth-highest-salary/">https://leetcode.cn/problems/nth-highest-salary/</a></p>
<p><em>3.2:</em> <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/rank-scores/">https://leetcode.cn/problems/rank-scores/</a></p>
<p><em>3.3:</em> <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/rearrange-products-table/">https://leetcode.cn/problems/rearrange-products-table/</a></p>
<p><em>3.4:</em> <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/calculate-special-bonus/">https://leetcode.cn/problems/calculate-special-bonus/</a></p>
<p>In our article, we won’t use the same data in these question. We’ll use a more simpler one to illustrate the functions. </p>
<h2 id="3-1-TopK-n-th-largest"><a href="#3-1-TopK-n-th-largest" class="headerlink" title="3.1 TopK &amp; n-th largest"></a>3.1 TopK &amp; n-th largest</h2><p>TopK means selecting top k rows according to some rules from the table. n-th largest means selecting the just n-th largest row according to some rules from the table</p>
<h3 id="3-1-1-MySQL"><a href="#3-1-1-MySQL" class="headerlink" title="3.1.1 MySQL"></a>3.1.1 MySQL</h3><p>To select some first couple of rows from the table, you can use the <code>LIMIT</code> keyword. <code>LIMIT M, N</code> will select from <code>M</code> row (0-index), a total of <code>N</code> rows. See the following example and explanation.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- table is</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> Alice <span class="operator">|</span> <span class="number">80</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob   <span class="operator">|</span> <span class="number">90</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Cindy <span class="operator">|</span> <span class="number">100</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> David <span class="operator">|</span> <span class="number">70</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Ella  <span class="operator">|</span> <span class="number">60</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Frank <span class="operator">|</span> <span class="number">80</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- select from 1st row, a total of 2 rows:</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Scores LIMIT <span class="number">1</span>, <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> Bob   <span class="operator">|</span> <span class="number">90</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Cindy <span class="operator">|</span> <span class="number">100</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- select total of 0 rows means nothing</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Scores LIMIT <span class="number">1</span>, <span class="number">0</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br><span class="line"><span class="operator">|</span> name <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- if starting index &gt; len(table), nothing would be returned</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Scores LIMIT <span class="number">7</span>, <span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br><span class="line"><span class="operator">|</span> name <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- select from minux number means select from first row</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Scores LIMIT <span class="number">-17</span>, <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> Alice <span class="operator">|</span> <span class="number">80</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob   <span class="operator">|</span> <span class="number">90</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br></pre></td></tr></table></figure>

<p>Therefore, it would be quite easy to implement the TopK and n-th largest. For example, if we want to find top 2 grade students and the 2nd highest student in this table:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- find top 2 grade students</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Scores <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span> LIMIT <span class="number">0</span>, <span class="number">2</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> name  <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"><span class="operator">|</span> Cindy <span class="operator">|</span> <span class="number">100</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> Bob   <span class="operator">|</span> <span class="number">90</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- find the 2nd highest student (note that it is 0-index)</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> Scores <span class="keyword">order</span> <span class="keyword">by</span> score <span class="keyword">desc</span> LIMIT <span class="number">1</span>, <span class="number">1</span>;</span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br><span class="line"><span class="operator">|</span> name <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br><span class="line"><span class="operator">|</span> Bob  <span class="operator">|</span> <span class="number">90</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">------+-------+</span></span><br></pre></td></tr></table></figure>

<h3 id="3-1-2-Pandas"><a href="#3-1-2-Pandas" class="headerlink" title="3.1.2 Pandas"></a>3.1.2 Pandas</h3><p>In pandas, we have the method <code>pd.DataFrame.nlargest(N, col_name)</code> to find the top N rows. Note that, after executing this method, the result table is already sorted descending. Access the last one row will just be the n-th largest. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># the df is</span></span><br><span class="line">    name  score</span><br><span class="line"><span class="number">0</span>  Alice     <span class="number">80</span></span><br><span class="line"><span class="number">1</span>    Bob     <span class="number">90</span></span><br><span class="line"><span class="number">2</span>  Cindy    <span class="number">100</span></span><br><span class="line"><span class="number">3</span>  David     <span class="number">70</span></span><br><span class="line"><span class="number">4</span>   Ella     <span class="number">60</span></span><br><span class="line"><span class="number">5</span>  Frank     <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># find top 2 grade students</span></span><br><span class="line">df.nlargest(N, <span class="string">&#x27;score&#x27;</span>)</span><br><span class="line"><span class="comment"># result is:</span></span><br><span class="line">    name  score</span><br><span class="line"><span class="number">2</span>  Cindy    <span class="number">100</span></span><br><span class="line"><span class="number">1</span>    Bob     <span class="number">90</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># find the 2nd highest student (note that it is 0-index)</span></span><br><span class="line">Scores.nlargest(N, <span class="string">&#x27;score&#x27;</span>).iloc[-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># result is:</span></span><br><span class="line">name     Bob</span><br><span class="line">score     <span class="number">90</span></span><br></pre></td></tr></table></figure>

<h2 id="3-2-rank-dense-rank"><a href="#3-2-rank-dense-rank" class="headerlink" title="3.2 rank, dense_rank"></a>3.2 rank, dense_rank</h2><p>This <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/rank-scores/">question</a> requires us to build a dense rank. That is, when there are rows that “score” are same, they should both appear and they should have the same score. Fortunately, we have built-in functions to help us achieve that.  </p>
<h3 id="3-2-1-MySQL"><a href="#3-2-1-MySQL" class="headerlink" title="3.2.1 MySQL"></a>3.2.1 MySQL</h3><p>There is a function called <code>DENSE_RANK()</code>, which can be used to create a new column based on the ranking information. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- The table is:</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> score <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> <span class="number">3.5</span>   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> <span class="number">3.65</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> <span class="number">4</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>  <span class="operator">|</span> <span class="number">3.85</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>  <span class="operator">|</span> <span class="number">4</span>     <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span>  <span class="operator">|</span> <span class="number">3.65</span>  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+-------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Do the ranking (the problems requires the &quot;dense rank&quot;)</span></span><br><span class="line"><span class="keyword">SELECT</span> S.score, <span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span> (</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> S.score <span class="keyword">DESC</span></span><br><span class="line">  ) <span class="keyword">AS</span> <span class="string">&#x27;rank&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  Scores S;</span><br><span class="line"><span class="comment">-- result is:</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+</span></span><br><span class="line"><span class="operator">|</span> score <span class="operator">|</span> rank <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>     <span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>     <span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.85</span>  <span class="operator">|</span> <span class="number">2</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.65</span>  <span class="operator">|</span> <span class="number">3</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.65</span>  <span class="operator">|</span> <span class="number">3</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.5</span>   <span class="operator">|</span> <span class="number">4</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+</span></span><br></pre></td></tr></table></figure>

<p>Usually, our ranking is not like this: if we have two 4.0 students, the rank of 3.85 student should be 3, not 2. The <code>RANK()</code> functions helps in this case:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> S.score, <span class="built_in">RANK</span>() <span class="keyword">OVER</span> (</span><br><span class="line">    <span class="keyword">ORDER</span> <span class="keyword">BY</span> S.score <span class="keyword">DESC</span></span><br><span class="line">  ) <span class="keyword">AS</span> <span class="string">&#x27;rank&#x27;</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">  Scores S;</span><br><span class="line"><span class="comment">-- result is:</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+</span></span><br><span class="line"><span class="operator">|</span> score <span class="operator">|</span> rank <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>     <span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">4</span>     <span class="operator">|</span> <span class="number">1</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.85</span>  <span class="operator">|</span> <span class="number">3</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.65</span>  <span class="operator">|</span> <span class="number">4</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.65</span>  <span class="operator">|</span> <span class="number">4</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3.5</span>   <span class="operator">|</span> <span class="number">6</span>    <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------+------+</span></span><br></pre></td></tr></table></figure>

<h3 id="3-2-2-Pandas"><a href="#3-2-2-Pandas" class="headerlink" title="3.2.2 Pandas"></a>3.2.2 Pandas</h3><p>In pandas, such operation is quite easy: we have the <code>pd.Series.rank()</code> function. This function has multiple parameters. The most important two are <code>method</code> and <code>ascending</code>. When <code>method</code> is <code>&#39;dense&#39;</code>, it performs as <code>dense_rank</code>. When <code>method</code> is <code>min</code>, it is the common ranking (meaning that when we have multiple same score, we should take minimum rank for all of them). <code>ascending</code> controls whether <code>1</code> is assigned to highest or lowest. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># scores is:</span></span><br><span class="line">   <span class="built_in">id</span>  score</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>    <span class="number">3.5</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>   <span class="number">3.65</span></span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>    <span class="number">4.0</span></span><br><span class="line"><span class="number">3</span>   <span class="number">4</span>   <span class="number">3.85</span></span><br><span class="line"><span class="number">4</span>   <span class="number">5</span>    <span class="number">4.0</span></span><br><span class="line"><span class="number">5</span>   <span class="number">6</span>   <span class="number">3.65</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create a new column, assign the dense_rank:</span></span><br><span class="line">scores[<span class="string">&#x27;rank&#x27;</span>] = scores[<span class="string">&#x27;score&#x27;</span>].rank(method=<span class="string">&#x27;dense&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># result is:</span></span><br><span class="line">   <span class="built_in">id</span>  score  rank</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>    <span class="number">3.5</span>   <span class="number">4.0</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>   <span class="number">3.65</span>   <span class="number">3.0</span></span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>    <span class="number">4.0</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>   <span class="number">4</span>   <span class="number">3.85</span>   <span class="number">2.0</span></span><br><span class="line"><span class="number">4</span>   <span class="number">5</span>    <span class="number">4.0</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>   <span class="number">6</span>   <span class="number">3.65</span>   <span class="number">3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># create a new column, assign the common rank:</span></span><br><span class="line">scores[<span class="string">&#x27;rank&#x27;</span>] = scores[<span class="string">&#x27;score&#x27;</span>].rank(method=<span class="string">&#x27;min&#x27;</span>, ascending=<span class="literal">False</span>)</span><br><span class="line"><span class="comment"># result is:</span></span><br><span class="line">   <span class="built_in">id</span>  score  rank</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>    <span class="number">3.5</span>   <span class="number">6.0</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>   <span class="number">3.65</span>   <span class="number">4.0</span></span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>    <span class="number">4.0</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">3</span>   <span class="number">4</span>   <span class="number">3.85</span>   <span class="number">3.0</span></span><br><span class="line"><span class="number">4</span>   <span class="number">5</span>    <span class="number">4.0</span>   <span class="number">1.0</span></span><br><span class="line"><span class="number">5</span>   <span class="number">6</span>   <span class="number">3.65</span>   <span class="number">4.0</span></span><br></pre></td></tr></table></figure>

<h2 id="3-3-row-to-column-conversion"><a href="#3-3-row-to-column-conversion" class="headerlink" title="3.3 row to column conversion"></a>3.3 row to column conversion</h2><h3 id="3-3-1-MySQL"><a href="#3-3-1-MySQL" class="headerlink" title="3.3.1 MySQL"></a>3.3.1 MySQL</h3><p>The idea is quite simple as illustrate below:</p>
<img src="/2023/09/07/Pandas-MySQL-Leetcode-Practice-Notes-3/q3.png" alt="q3" style="zoom:50%;">

<p>First, we extract each column to form a new table corresponding to each store. Then, we concatenate (“Union”) three tables together. Note that when we are extracting the table, we should remove “null” rows.</p>
<p>Follow this idea, our implementation would be relatively easy:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> product_id, <span class="string">&#x27;store1&#x27;</span> <span class="keyword">as</span> store, store1 <span class="keyword">as</span> price <span class="keyword">from</span> Products <span class="keyword">where</span> store1 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> product_id, <span class="string">&#x27;store2&#x27;</span> <span class="keyword">as</span> store, store2 <span class="keyword">as</span> price <span class="keyword">from</span> Products <span class="keyword">where</span> store2 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br><span class="line"><span class="keyword">union</span> <span class="keyword">all</span></span><br><span class="line"><span class="keyword">select</span> product_id, <span class="string">&#x27;store3&#x27;</span> <span class="keyword">as</span> store, store3 <span class="keyword">as</span> price <span class="keyword">from</span> Products <span class="keyword">where</span> store3 <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span></span><br></pre></td></tr></table></figure>



<h3 id="3-3-2-Pandas"><a href="#3-3-2-Pandas" class="headerlink" title="3.3.2 Pandas"></a>3.3.2 Pandas</h3><p>In pandas, you can use the similar idea as listed in the above subsection. But Pandas provides more powerful tools, <code>pd.melt</code>, which helps us to convert wide (row) format into long (column) format: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Input: </span><br><span class="line">Products table:</span><br><span class="line">+------------+--------+--------+--------+</span><br><span class="line">| product_id | store1 | store2 | store3 |</span><br><span class="line">+------------+--------+--------+--------+</span><br><span class="line">| 0          | 95     | 100    | 105    |</span><br><span class="line">| 1          | 70     | null   | 80     |</span><br><span class="line">+------------+--------+--------+--------+</span><br><span class="line">Output: </span><br><span class="line">+------------+--------+-------+</span><br><span class="line">| product_id | store  | price |</span><br><span class="line">+------------+--------+-------+</span><br><span class="line">| 0          | store1 | 95    |</span><br><span class="line">| 0          | store2 | 100   |</span><br><span class="line">| 0          | store3 | 105   |</span><br><span class="line">| 1          | store1 | 70    |</span><br><span class="line">| 1          | store3 | 80    |</span><br><span class="line">+------------+--------+-------+</span><br></pre></td></tr></table></figure>

<p>The <code>id_vars</code> is the identifier column (will not be changed), <code>value_vars</code> is the columns to be converted. <code>var_name</code> is the new column name from converted columns. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">df = products.melt(</span><br><span class="line">    id_vars=<span class="string">&#x27;product_id&#x27;</span>, </span><br><span class="line">    value_vars=[<span class="string">&#x27;store1&#x27;</span>, <span class="string">&#x27;store2&#x27;</span>, <span class="string">&#x27;store3&#x27;</span>],</span><br><span class="line">    var_name=<span class="string">&#x27;store&#x27;</span>, </span><br><span class="line">    value_name=<span class="string">&#x27;price&#x27;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>



<h2 id="3-4-Conditional-operator"><a href="#3-4-Conditional-operator" class="headerlink" title="3.4 Conditional operator"></a>3.4 Conditional operator</h2><p>The question requires us to set each value according to a predicate. Such basic requirement is well-supported by the MySQL and Pandas.</p>
<h3 id="3-4-1-MySQL"><a href="#3-4-1-MySQL" class="headerlink" title="3.4.1 MySQL"></a>3.4.1 MySQL</h3><p>In MySQL, <code>if(cond, true_value, false_value)</code> is a good helper. This should appear after <code>SELECT</code>. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">    employee_id,</span><br><span class="line">    IF(employee_id <span class="operator">%</span> <span class="number">2</span> <span class="operator">=</span> <span class="number">1</span> <span class="keyword">AND</span> name <span class="keyword">NOT</span> REGEXP <span class="string">&#x27;^M&#x27;</span>, salary, <span class="number">0</span>) <span class="keyword">AS</span> bonus </span><br><span class="line"><span class="keyword">FROM</span> </span><br><span class="line">    employees </span><br></pre></td></tr></table></figure>

<p>The second column, <code>bonus</code>, entry would be the same value of <code>salary</code> if the condition is satisfied, otherwise it is 0. For the condition, the second is the grammar of regular expression, asserting true only when name does not start with <code>M</code>. You may also use <code>name NOT LIKE &#39;M%&#39;</code> for the second condition.</p>
<h3 id="3-4-2-Pandas"><a href="#3-4-2-Pandas" class="headerlink" title="3.4.2 Pandas"></a>3.4.2 Pandas</h3><p>In pandas, we can use the <code>pd.DataFrame.apply</code> function to achieve this. The <code>apply</code> function accepts a function, <code>f(x)</code>, which <code>x</code> is the “current” row. Based on the information on that row, it returns a value. For example, in this question, the condition is “the employee is <strong>an odd number</strong> and <strong>the employee’s name does not start with the character</strong> <code>&#39;M&#39;</code>. “</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># judge function</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x</span>):</span><br><span class="line">	<span class="keyword">if</span> x[<span class="string">&#x27;employee_id&#x27;</span>] % <span class="number">2</span> == <span class="number">1</span> <span class="keyword">and</span> <span class="keyword">not</span> x[<span class="string">&#x27;name&#x27;</span>].startswith(<span class="string">&#x27;M&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> x[<span class="string">&#x27;salary&#x27;</span>] </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    </span><br><span class="line"><span class="comment"># Apply it to the dataframe for the new column:</span></span><br><span class="line">employees[<span class="string">&#x27;bonus&#x27;</span>] = employees.apply(f, axis=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Sample input:</span></span><br><span class="line">| employee_id | name    | salary |</span><br><span class="line">| ----------- | ------- | ------ |</span><br><span class="line">| <span class="number">2</span>           | Meir    | <span class="number">3000</span>   |</span><br><span class="line">| <span class="number">3</span>           | Michael | <span class="number">3800</span>   |</span><br><span class="line">| <span class="number">7</span>           | Addilyn | <span class="number">7400</span>   |</span><br><span class="line">| <span class="number">8</span>           | Juan    | <span class="number">6100</span>   |</span><br><span class="line">| <span class="number">9</span>           | Kannon  | <span class="number">7700</span>   |</span><br><span class="line"></span><br><span class="line"><span class="comment"># Sample result of employees[&#x27;bonus&#x27;]:</span></span><br><span class="line"><span class="number">0</span>       <span class="number">0</span></span><br><span class="line"><span class="number">1</span>       <span class="number">0</span></span><br><span class="line"><span class="number">2</span>    <span class="number">7400</span></span><br><span class="line"><span class="number">3</span>       <span class="number">0</span></span><br><span class="line"><span class="number">4</span>    <span class="number">7700</span></span><br><span class="line">Name: bonus, dtype: int64</span><br></pre></td></tr></table></figure>

<p>Which satisfies the requirement.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/09/02/Pandas-MySQL-Leetcode-Practice-Notes-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/09/02/Pandas-MySQL-Leetcode-Practice-Notes-2/" class="post-title-link" itemprop="url">Pandas & MySQL Leetcode Practice Notes 2--String operations</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-09-02 12:44:11" itemprop="dateCreated datePublished" datetime="2023-09-02T12:44:11+08:00">2023-09-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-08 19:23:02" itemprop="dateModified" datetime="2023-09-08T19:23:02+08:00">2023-09-08</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Pandas-SQL/" itemprop="url" rel="index"><span itemprop="name">Pandas_SQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="2-String-Operations"><a href="#2-String-Operations" class="headerlink" title="2. String Operations"></a>2. String Operations</h1><h2 id="2-1-MySQL"><a href="#2-1-MySQL" class="headerlink" title="2.1 MySQL"></a>2.1 MySQL</h2><!--
create table if not exists fruits (id int, content varchar(10));
delete from fruits where 1=1;
insert into fruits values (1, 'apple');
insert into fruits values (2, 'banana');
insert into fruits values (3, 'orange');
select * from fruits;
-->

<p>Filtering string in SQL is generally same as the process for filtering numeric. There are many built-in functions to help you achieve some string operation. For example, <code>UPPER()</code>, <code>LOWER()</code>, <code> CONCAT()</code>, <code> SUBSTRING()</code> .</p>
<ul>
<li><code>length()</code> function returns length of that columns’ entries:</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- table is</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> apple   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> banana  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> orange  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Get len of each entry in &quot;content&quot; column</span></span><br><span class="line"><span class="keyword">select</span> length(content) <span class="keyword">from</span> fruits;</span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> length(content) <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">5</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">6</span>               <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Assign the length column to table, named &quot;content_len&quot;:</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span>, length(content) <span class="keyword">as</span> content_len <span class="keyword">from</span> fruits;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+-------------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span> content_len <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+-------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> apple   <span class="operator">|</span> <span class="number">5</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> banana  <span class="operator">|</span> <span class="number">6</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> orange  <span class="operator">|</span> <span class="number">6</span>           <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+-------------+</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>LIKE &quot;pattern&quot;</code>  tells whether a column match this pattern, so that you can filter others out. The pattern uses <code>_</code> to match any ONE character, and <code>%</code> to match any MULTIPLE (&gt;1) character.</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- table is</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> apple   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> banana  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> orange  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Get a boolean column where &quot;1&quot; entry means content starts with &quot;a&quot;</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> content <span class="keyword">like</span> &quot;a%&quot; <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">0</span>                 <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-------------------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Combine with &quot;where&quot; to do filtering</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> fruits <span class="keyword">where</span> content <span class="keyword">like</span> &quot;a%&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> apple   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Sometimes, the pattern above cannot handle some complex queries. We can use regular expression here. The grammar is: <code>&lt;col_name&gt; REGEXP &#39;pattern&#39;</code>. Note that this by default behaves like “match”, checking from the beginning.</li>
</ul>
 <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- table is</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> apple   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> banana  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> orange  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Match all entries, begining with &quot;a&quot;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> fruits <span class="keyword">where</span> content REGEXP &quot;a\w*&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">1</span>  <span class="operator">|</span> apple   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"></span><br><span class="line"><span class="comment">-- Match all entries, containing &quot;an&quot;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> fruits <span class="keyword">where</span> content REGEXP &quot;\w*an\w*&quot;;</span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> id <span class="operator">|</span> content <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br><span class="line"><span class="operator">|</span> <span class="number">2</span>  <span class="operator">|</span> banana  <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> <span class="number">3</span>  <span class="operator">|</span> orange  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----+---------+</span></span><br></pre></td></tr></table></figure>



<h2 id="2-2-Pandas"><a href="#2-2-Pandas" class="headerlink" title="2.2 Pandas"></a>2.2 Pandas</h2><p>For numeric data types, we usually directly use grammar like <code>df[&#39;col&#39;] &gt; 5</code> to get the indexing series. For string operations, we have some similar ways to get the indexing series. </p>
<p><strong>String Accessor.</strong> For each column, we can use <code>.str</code> to get its <code>pandas.core.strings.accessor.StringMethods</code>. This object has various of string operation functions, such as <code>.replace()</code>, <code>.find()</code>, <code>.len()</code>, <code>.startswith()</code>…… </p>
<ul>
<li>Some function, such as <code>.len()</code>, returns a new integer series, containing length of string for each entry:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># df is:</span></span><br><span class="line">   <span class="built_in">id</span> content</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   apple</span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>  banana</span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>  orange</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get len of each entry in &quot;content&quot; column</span></span><br><span class="line">df[<span class="string">&#x27;content&#x27;</span>].<span class="built_in">str</span>.<span class="built_in">len</span>()</span><br><span class="line"><span class="number">0</span>    <span class="number">5</span></span><br><span class="line"><span class="number">1</span>    <span class="number">6</span></span><br><span class="line"><span class="number">2</span>    <span class="number">6</span></span><br><span class="line">Name: content, dtype: int64</span><br><span class="line"></span><br><span class="line"><span class="comment"># Assign the len series to df, named &quot;content_len&quot;:</span></span><br><span class="line">df[<span class="string">&#x27;content_len&#x27;</span>] = df[<span class="string">&#x27;content&#x27;</span>].<span class="built_in">str</span>.<span class="built_in">len</span>()</span><br><span class="line"></span><br><span class="line"><span class="comment"># df now is:</span></span><br><span class="line">   <span class="built_in">id</span> content  content_len</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   apple            <span class="number">5</span></span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>  banana            <span class="number">6</span></span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>  orange            <span class="number">6</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Some function, like <code>.startwith()</code>, returns a new boolean series, so you can do indexing:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># df is:</span></span><br><span class="line">   <span class="built_in">id</span> content</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   apple</span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>  banana</span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>  orange</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get indexing series where &quot;content&quot; entry starts with &quot;a&quot;</span></span><br><span class="line">cond = df[<span class="string">&#x27;content&#x27;</span>].<span class="built_in">str</span>.startswith(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># cond is:</span></span><br><span class="line"><span class="number">0</span>     <span class="literal">True</span></span><br><span class="line"><span class="number">1</span>    <span class="literal">False</span></span><br><span class="line"><span class="number">2</span>    <span class="literal">False</span></span><br><span class="line">Name: content, dtype: <span class="built_in">bool</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Do filtering</span></span><br><span class="line">df = df.loc[cond, :]</span><br><span class="line"></span><br><span class="line"><span class="comment"># df is:</span></span><br><span class="line">   <span class="built_in">id</span> content</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   apple</span><br></pre></td></tr></table></figure>

<ul>
<li>Regular Expression</li>
</ul>
<p>Sometimes, we want to utilize Regex to help us match entries. We have <code>.match()</code> function. Note that <code>match</code> will exactly match from the beginning. If you just want to match any substring, use <code>.contains</code> instead. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># df is:</span></span><br><span class="line">   <span class="built_in">id</span> content</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   apple</span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>  banana</span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>  orange</span><br><span class="line"></span><br><span class="line"><span class="comment"># Match all entries, begining with &quot;a&quot;</span></span><br><span class="line">cond = df[<span class="string">&#x27;content&#x27;</span>].<span class="built_in">str</span>.<span class="keyword">match</span>(<span class="string">r&#x27;a[a-zA-Z]*&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Result will be:</span></span><br><span class="line">df.loc[cond, :]</span><br><span class="line">   <span class="built_in">id</span> content</span><br><span class="line"><span class="number">0</span>   <span class="number">1</span>   apple</span><br><span class="line"></span><br><span class="line"><span class="comment"># Match all entries, containing &quot;an&quot;</span></span><br><span class="line">cond = df[<span class="string">&#x27;content&#x27;</span>].<span class="built_in">str</span>.contains(<span class="string">r&#x27;an&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Result will be:</span></span><br><span class="line">df.loc[cond, :]</span><br><span class="line">   <span class="built_in">id</span> content</span><br><span class="line"><span class="number">1</span>   <span class="number">2</span>  banana</span><br><span class="line"><span class="number">2</span>   <span class="number">3</span>  orange</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/08/20/Pandas-MySQL-Leetcode-Practice-Notes-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/08/20/Pandas-MySQL-Leetcode-Practice-Notes-1/" class="post-title-link" itemprop="url">Pandas & MySQL Leetcode Practice Notes 1--Condition Filter & Misc</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-08-20 20:05:37" itemprop="dateCreated datePublished" datetime="2023-08-20T20:05:37+08:00">2023-08-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-02 12:47:00" itemprop="dateModified" datetime="2023-09-02T12:47:00+08:00">2023-09-02</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Pandas-SQL/" itemprop="url" rel="index"><span itemprop="name">Pandas_SQL</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>There are 30 questions to practice Python Pandas and MySQL on <a target="_blank" rel="noopener" href="https://leetcode.cn/studyplan/30-days-of-pandas/">https://leetcode.cn/studyplan/30-days-of-pandas/</a> . These questions basically practice the fundamental skills. Pandas and MySQL are similar in some aspects, and one can write the same functional code in two languages. I’ll practice my skill with these questions, and write notes about the equivalent operations in two languages. </p>
<p>Accordingly, there are six sections in this section (so will use 6 articles in total):</p>
<ol>
<li>Condition Filter &amp; Misc</li>
<li>String Manipulation</li>
<li>Data Manipulation</li>
<li>Data Statistics</li>
<li>Grouping</li>
<li>Merging</li>
</ol>
<h1 id="1-Condition-Filter-Join-Misc"><a href="#1-Condition-Filter-Join-Misc" class="headerlink" title="1. Condition Filter &amp; Join &amp; Misc"></a>1. Condition Filter &amp; Join &amp; Misc</h1><p>The four related question in this area are:</p>
<p>Basic <code>where</code> clause filtering, with <code>OR</code> operator: <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/big-countries/">https://leetcode.cn/problems/big-countries/</a></p>
<p>Basic <code>where</code> clause filtering, with <code>AND</code> operator: <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/recyclable-and-low-fat-products/">https://leetcode.cn/problems/recyclable-and-low-fat-products/</a></p>
<p>Joining two tables, with <code>where</code> clause filtering null: <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/customers-who-never-order/">https://leetcode.cn/problems/customers-who-never-order/</a></p>
<p>Basic <code>where</code> clause filtering, with <code>DISTINCT</code> and <code>sort</code>: <a target="_blank" rel="noopener" href="https://leetcode.cn/problems/article-views-i">https://leetcode.cn/problems/article-views-i</a></p>
<h2 id="1-1-Condition"><a href="#1-1-Condition" class="headerlink" title="1.1 Condition"></a>1.1 Condition</h2><p>Typical condition filter work is asking us to do like this:</p>
<blockquote>
<p>Filter the <strong>big</strong> country in World scheme. A country is <strong>big</strong> if:</p>
<ul>
<li>it has an area of at least three million (i.e., <code>3000000 km2</code>), or</li>
<li>it has a population of at least twenty-five million (i.e., <code>25000000</code>).</li>
</ul>
</blockquote>
<p>We’ll use this example to illustrate the point. </p>
<h3 id="1-1-a-MySQL"><a href="#1-1-a-MySQL" class="headerlink" title="1.1.a MySQL"></a>1.1.a MySQL</h3><p>A typical condition filter in SQL looks like this:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">&lt;</span>col_names<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">from</span> <span class="operator">&lt;</span>table_name<span class="operator">&gt;</span></span><br><span class="line"><span class="keyword">where</span> (</span><br><span class="line">	<span class="operator">&lt;</span><span class="keyword">condition</span> predicate<span class="operator">&gt;</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<p>SQL allows the use of the logical connectives <strong>and, or, and not</strong>. </p>
<p>The operands of the logical connectives can be expressions involving the comparison operators <strong>&lt;, &lt;&#x3D;, &gt;, &gt;&#x3D;, &#x3D;, and &lt;&gt;</strong> (Note that, equal symbol is one <code>=</code>, but not <code>==</code>!)</p>
<p>For example, in the codes above, the answer is</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, population, area</span><br><span class="line"><span class="keyword">FROM</span> World</span><br><span class="line"><span class="keyword">WHERE</span> area <span class="operator">&gt;=</span> <span class="number">3000000</span> <span class="keyword">OR</span> population <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br></pre></td></tr></table></figure>



<h3 id="1-1-b-Pandas"><a href="#1-1-b-Pandas" class="headerlink" title="1.1.b Pandas"></a>1.1.b Pandas</h3><p>Filter operations in pandas is a little bit difference. We should know two basics things first:</p>
<ul>
<li>Condition result in Index Series</li>
</ul>
<p>If we want to get all data that are greater than 5 in <code>df</code>‘s <code>col1</code> column, the code and result is as below:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(df)</span><br><span class="line"><span class="comment"># OUTPUT:</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  name  col1  col2</span></span><br><span class="line"><span class="string">0    a     1    10</span></span><br><span class="line"><span class="string">1    b     2     9</span></span><br><span class="line"><span class="string">2    c     3     8</span></span><br><span class="line"><span class="string">3    d     4     7</span></span><br><span class="line"><span class="string">4    e     5     6</span></span><br><span class="line"><span class="string">5    f     6     5</span></span><br><span class="line"><span class="string">6    g     7     4</span></span><br><span class="line"><span class="string">7    h     8     3</span></span><br><span class="line"><span class="string">8    i     9     2</span></span><br><span class="line"><span class="string">9    j    10     1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(df[<span class="string">&#x27;col1&#x27;</span>] &gt; <span class="number">5</span>)</span><br><span class="line"><span class="comment"># OUTPUT: </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0    False</span></span><br><span class="line"><span class="string">1    False</span></span><br><span class="line"><span class="string">2    False</span></span><br><span class="line"><span class="string">3    False</span></span><br><span class="line"><span class="string">4    False</span></span><br><span class="line"><span class="string">5     True</span></span><br><span class="line"><span class="string">6     True</span></span><br><span class="line"><span class="string">7     True</span></span><br><span class="line"><span class="string">8     True</span></span><br><span class="line"><span class="string">9     True</span></span><br><span class="line"><span class="string">Name: col1, dtype: bool</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>As you can see, the result of <code>df[&#39;col1&#39;] &gt; 5</code> is a bool Series with <code>len(df)</code> size. The entry is True only when the corresponding entry at <code>col1</code> satisfies the condition. </p>
<ul>
<li>Indexing by the Index Series</li>
</ul>
<p>We can pass this bool index series in to the <code>df.loc[]</code>. Then, only the rows with the condition satisfied are displayed:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">a = df.loc[df[<span class="string">&#x27;col1&#x27;</span>] &gt; <span class="number">5</span>]</span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">  name  col1  col2</span></span><br><span class="line"><span class="string">5    f     6     5</span></span><br><span class="line"><span class="string">6    g     7     4</span></span><br><span class="line"><span class="string">7    h     8     3</span></span><br><span class="line"><span class="string">8    i     9     2</span></span><br><span class="line"><span class="string">9    j    10     1</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>By such method, we can do the filtering in the pandas. Note that:</p>
<p>For the <code>and</code>, <code>or</code> and <code>not</code> logic operators, the corresponding operator in pandas is <code>&amp;</code>, <code>|</code> and <code>~</code>. For example:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cond1 = df[<span class="string">&#x27;col1&#x27;</span>] &gt; <span class="number">5</span></span><br><span class="line">cond2 = df[<span class="string">&#x27;col2&#x27;</span>] &gt; <span class="number">2</span></span><br><span class="line"></span><br><span class="line">b = df.loc[cond1 &amp; cond2]</span><br><span class="line"></span><br><span class="line">c = df.loc[ (df[<span class="string">&#x27;col1&#x27;</span>] &gt; <span class="number">5</span>) &amp; (df[<span class="string">&#x27;col2&#x27;</span>] &gt; <span class="number">2</span>) ]</span><br></pre></td></tr></table></figure>

<p><strong>Note</strong> that the <code>()</code> symbols are necessary because of the operator precedence. For example, in the codes above, the answer is:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cond1 = world[<span class="string">&#x27;area&#x27;</span>] &gt;= <span class="number">300_0000</span></span><br><span class="line">cond2 = world[<span class="string">&#x27;population&#x27;</span>] &gt;= <span class="number">2500_0000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> world.loc[cond1 | cond2, [<span class="string">&#x27;name&#x27;</span>, <span class="string">&#x27;population&#x27;</span>, <span class="string">&#x27;area&#x27;</span>]]</span><br></pre></td></tr></table></figure>



<h2 id="1-2-Misc"><a href="#1-2-Misc" class="headerlink" title="1.2 Misc"></a>1.2 Misc</h2><h3 id="1-2-1-Rename-output-columns"><a href="#1-2-1-Rename-output-columns" class="headerlink" title="1.2.1 Rename output columns"></a>1.2.1 Rename output columns</h3><h4 id="1-2-1-a-MySQL"><a href="#1-2-1-a-MySQL" class="headerlink" title="1.2.1.a MySQL"></a>1.2.1.a MySQL</h4><p>In MySQL, rename a column is very easy. By default, if the command is</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> name, population, area</span><br><span class="line"><span class="keyword">FROM</span> World</span><br><span class="line"><span class="keyword">WHERE</span> area <span class="operator">&gt;=</span> <span class="number">3000000</span> <span class="keyword">OR</span> population <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br></pre></td></tr></table></figure>

<p>Then the output columns are named <code>name</code>, <code>population</code>, and <code>area</code>. To rename, just use the <code>as</code> symbol to give a new name as output:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- change name =&gt; Name, population =&gt; Population, area =&gt; Area</span></span><br><span class="line"><span class="keyword">SELECT</span> name <span class="keyword">as</span> Name, population <span class="keyword">as</span> Population, area <span class="keyword">as</span> Area</span><br><span class="line"><span class="keyword">FROM</span> World</span><br><span class="line"><span class="keyword">WHERE</span> area <span class="operator">&gt;=</span> <span class="number">3000000</span> <span class="keyword">OR</span> population <span class="operator">&gt;=</span> <span class="number">25000000</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-1-b-Pandas"><a href="#1-2-1-b-Pandas" class="headerlink" title="1.2.1.b Pandas"></a>1.2.1.b Pandas</h4><p>In pandas, we can use the <code>pd.DataFrame.rename</code> function to rename the columns. The input parameter <code>columns</code> is a <code>dict[str, str]</code>, where <code>key</code> is the old name, and the <code>value</code> is the new name. For example in the example below, we make all names capitalized:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">df = df.rename(columns=&#123;<span class="string">&#x27;name&#x27;</span>: <span class="string">&#x27;Name&#x27;</span>, <span class="string">&#x27;population&#x27;</span>: <span class="string">&#x27;Population&#x27;</span>, <span class="string">&#x27;area&#x27;</span>: <span class="string">&#x27;Area&#x27;</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-2-2-Swap-output-columns-order"><a href="#1-2-2-Swap-output-columns-order" class="headerlink" title="1.2.2 Swap output columns order"></a>1.2.2 Swap output columns order</h3><h4 id="1-2-2-a-MySQL"><a href="#1-2-2-a-MySQL" class="headerlink" title="1.2.2.a MySQL"></a>1.2.2.a MySQL</h4><p>In SQL, this work is relatively easy. You only need to swap the column names in the <code>select</code> command: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- show with A, B, C columns </span></span><br><span class="line"><span class="keyword">select</span> A, B, C <span class="keyword">from</span> <span class="keyword">table</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- show with C, B, A columns </span></span><br><span class="line"><span class="keyword">select</span> C, B, A <span class="keyword">from</span> <span class="keyword">table</span>;</span><br></pre></td></tr></table></figure>

<h4 id="1-2-2-b-Pandas"><a href="#1-2-2-b-Pandas" class="headerlink" title="1.2.2.b Pandas"></a>1.2.2.b Pandas</h4><p>The method is relatively similar as the code in MySQL, by:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># show with A, B, C columns </span></span><br><span class="line">df.loc[:, [<span class="string">&#x27;A&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;C&#x27;</span>]]</span><br><span class="line"></span><br><span class="line"><span class="comment"># show with C, B, A columns </span></span><br><span class="line">df.loc[:, [<span class="string">&#x27;C&#x27;</span>, <span class="string">&#x27;B&#x27;</span>, <span class="string">&#x27;A&#x27;</span>]]</span><br></pre></td></tr></table></figure>

<h3 id="1-2-3-Remove-duplicate-rows"><a href="#1-2-3-Remove-duplicate-rows" class="headerlink" title="1.2.3 Remove duplicate rows"></a>1.2.3 Remove duplicate rows</h3><h4 id="1-2-3-a-MySQL"><a href="#1-2-3-a-MySQL" class="headerlink" title="1.2.3.a MySQL"></a>1.2.3.a MySQL</h4><p>It is quite easy to do that: you only need to add <code>DISTINCT</code> keyword. For example: </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="keyword">DISTINCT</span> student_id</span><br><span class="line"><span class="keyword">from</span> courses</span><br></pre></td></tr></table></figure>

<h4 id="1-2-3-b-Pandas"><a href="#1-2-3-b-Pandas" class="headerlink" title="1.2.3.b Pandas"></a>1.2.3.b Pandas</h4><p>The DataFrame has a method called <code>drop_duplicates()</code>. For example: </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">selected_views = selected_views.drop_duplicates()</span><br></pre></td></tr></table></figure>

<p>More advanced usage is use parameter <code>subset</code> to  tell which columns for identifying duplicates, by default use all of the columns. For example, the following code drop the duplicate rows whenever they have same value in column <code>teacher_id</code>, <code>subject_id</code>. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">teacher = teacher.drop_duplicates(subset=[<span class="string">&#x27;teacher_id&#x27;</span>, <span class="string">&#x27;subject_id&#x27;</span>])</span><br></pre></td></tr></table></figure>

<h3 id="1-2-4-Sort"><a href="#1-2-4-Sort" class="headerlink" title="1.2.4 Sort"></a>1.2.4 Sort</h3><h4 id="1-2-4-a-MySQL"><a href="#1-2-4-a-MySQL" class="headerlink" title="1.2.4.a MySQL"></a>1.2.4.a MySQL</h4><p>In the <code>select</code> statement, add with <code>order by &lt;col&gt; asc/desc</code> statement. <code>&lt;col&gt;</code> indicates sort according to which column, <code>asc</code> means ascending sorting, <code>desc</code> means descending sorting. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> v.author_id </span><br><span class="line"><span class="keyword">from</span> Views <span class="keyword">as</span> v</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">asc</span></span><br></pre></td></tr></table></figure>

<p>To sort according multiple columns (if first column is the same, sort by second column), do it by:</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> v.author_id </span><br><span class="line"><span class="keyword">from</span> Views <span class="keyword">as</span> v</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> id <span class="keyword">asc</span>, col2 <span class="keyword">desc</span></span><br></pre></td></tr></table></figure>

<h4 id="1-2-4-b-Pandas"><a href="#1-2-4-b-Pandas" class="headerlink" title="1.2.4.b Pandas"></a>1.2.4.b Pandas</h4><p>Use the <code>pd.DataFrame.sort_values()</code> to sort according to which column(s). If we want to sort from biggest to smallest, use <code>ascending</code> parameter. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sort by one column, id</span></span><br><span class="line">selected_views = selected_views.sort_values(by=[<span class="string">&#x27;id&#x27;</span>])</span><br><span class="line">selected_views = selected_views.sort_values(by=[<span class="string">&#x27;id&#x27;</span>], ascending=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># sort by two columns</span></span><br><span class="line"><span class="comment"># if first column is the same, sort by second column</span></span><br><span class="line">selected_views = selected_views.sort_values(by=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;view_date&#x27;</span>])</span><br><span class="line">selected_views = selected_views.sort_values(by=[<span class="string">&#x27;id&#x27;</span>, <span class="string">&#x27;view_date&#x27;</span>], ascending=[<span class="literal">True</span>, <span class="literal">False</span>])</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Future</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">36</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">1</span>
        <span class="site-state-item-name">tags</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Future</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
