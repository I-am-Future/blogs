<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/time-machine.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":true},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":true,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Future&#39;s blog">
<meta property="og:url" content="http://example.com/page/3/index.html">
<meta property="og:site_name" content="Future&#39;s blog">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Future">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/page/3/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>Future's blog</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Future's blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/27/Pytorch-Practical-Basics-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/27/Pytorch-Practical-Basics-1/" class="post-title-link" itemprop="url">PyTorch Practical Hand-Written Modules Basics 1--Tensor basics (attributes, creation)</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-27 11:47:00" itemprop="dateCreated datePublished" datetime="2023-05-27T11:47:00+08:00">2023-05-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-18 23:54:31" itemprop="dateModified" datetime="2023-08-18T23:54:31+08:00">2023-08-18</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>This series would not be a general PyTorch introduction or detailed tutorials. Instead, this would be a very practical introduction to some common basics needed for Implementing Hand-Written Modules. </p>
<p>This is the First Section of this series, we would like to introduce some tensor basics, including: tensor attributes, tensor creation, and some other things. All the things I mentioned will be practical, but not exhaustive. </p>
<h1 id="1-Tensor-attributes"><a href="#1-Tensor-attributes" class="headerlink" title="1. Tensor attributes"></a>1. Tensor attributes</h1><p>We introduce 5 key attributes for <code>torch.tensor</code> <code>a</code> here:</p>
<h2 id="1-1-a-shape"><a href="#1-1-a-shape" class="headerlink" title="1.1 a.shape"></a>1.1 a.shape</h2><ul>
<li><code>a.shape</code>: Returns the shape of <code>a</code>. The return type is <code>torch.Size</code>. Example:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = torch.randn(<span class="number">10</span>, <span class="number">20</span>) <span class="comment"># create a 10x20 tensor</span></span><br><span class="line">a.shape</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">torch.Size([<span class="number">10</span>, <span class="number">20</span>])</span><br></pre></td></tr></table></figure>

<p>The <code>torch.Size</code> object supports some tricks:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># unpack</span></span><br><span class="line">h, w = a.shape</span><br><span class="line">h, w</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">(<span class="number">10</span>, <span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># unpack in function calls</span></span><br><span class="line"><span class="built_in">print</span>(*a.shape)</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"><span class="number">10</span> <span class="number">20</span></span><br></pre></td></tr></table></figure>



<h2 id="1-2-a-ndim"><a href="#1-2-a-ndim" class="headerlink" title="1.2 a.ndim"></a>1.2 a.ndim</h2><ul>
<li><code>a.ndim</code>: Returns number of dimensions of <code>a</code>.</li>
</ul>
<p>It looks like <code>len(a.shape)</code>. It also has a function version, called <code>a.ndimension()</code></p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a.ndim</span><br><span class="line">a.ndimension()</span><br><span class="line"><span class="built_in">len</span>(a.shape)</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure>



<h2 id="1-3-a-device"><a href="#1-3-a-device" class="headerlink" title="1.3 a.device"></a>1.3 a.device</h2><ul>
<li><code>a.device</code>: Returns where the <code>a</code> locates.</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.device</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">device(<span class="built_in">type</span>=<span class="string">&#x27;cpu&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>Convert to CUDA by using <code>a = a.to(&#39;cuda:0&#39;)</code>. Convert back to CPU by using <code>a = a.to(&#39;cpu&#39;)</code> or <code>a = a.cpu()</code>.</p>
<h2 id="1-4-a-dtype"><a href="#1-4-a-dtype" class="headerlink" title="1.4 a.dtype"></a>1.4 a.dtype</h2><ul>
<li><code>a.dtype</code>: Returns the data type of <code>a</code>.</li>
</ul>
<p>The data type of tensor <code>a</code>. It’s very important in PyTorch! Usually, the data type would be <code>torch.float32</code> or <code>torch.int64</code>. Some data type convert method:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># to float32</span></span><br><span class="line">f = a.<span class="built_in">float</span>()</span><br><span class="line">f.dtype</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">torch.float32</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># to int64</span></span><br><span class="line">l = a.long()</span><br><span class="line">l.dtype</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">torch.int64</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># to int32</span></span><br><span class="line">i = a.<span class="built_in">int</span>()</span><br><span class="line">i.dtype</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">torch.int32</span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Also, we can use .to() as well:</span></span><br><span class="line">f = a.to(torch.float32)</span><br><span class="line">f.dtype</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">torch.float32</span><br></pre></td></tr></table></figure>



<h2 id="1-5-a-numel"><a href="#1-5-a-numel" class="headerlink" title="1.5 a.numel"></a>1.5 a.numel</h2><ul>
<li><code>a.numel()</code>: Returns <strong>num</strong>ber of <strong>el</strong>ements in <code>a</code>. Usually used in counting number of parameters in the model.</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a.numel()</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"><span class="number">200</span>  <span class="comment"># it&#x27;s 10*20!</span></span><br></pre></td></tr></table></figure>

<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torchvision</span><br><span class="line">model = torchvision.models.resnet50()</span><br><span class="line"><span class="built_in">sum</span>([p.numel() <span class="keyword">for</span> p <span class="keyword">in</span> model.parameters()])</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"><span class="number">25557032</span></span><br></pre></td></tr></table></figure>



<h1 id="2-Tensor-creation"><a href="#2-Tensor-creation" class="headerlink" title="2. Tensor creation"></a>2. Tensor creation</h1><p>PyTorch tensors plays key role in writing deep learning programs. Usually, tensor are from two types: data and auxiliary variables (e.g., masks).</p>
<h2 id="2-1-From-data"><a href="#2-1-From-data" class="headerlink" title="2.1 From data"></a>2.1 From data</h2><p>For the data tensor, they are usually converted from other packages, such as <code>numpy</code>. We have several methods to convert it to <code>torch.tensor</code>.</p>
<ul>
<li><p><code>torch.tensor(arr)</code> Returns a deep copy of <code>arr</code>, i.e., the storage data is independent with <code>arr</code>. (Very memory and time consuming, not recommended for most cases)</p>
</li>
<li><p><code>torch.from_numpy(arr)</code> Returns a shallow copy tensor, i.e., the storage data is shared with <code>arr</code>. </p>
</li>
<li><p><code>torch.as_tensor(arr, dtype=..., device=...)</code> If <code>dtype</code> and <code>device</code> is same as <code>arr</code>, then it behaves like <code>torch.from_numpy()</code> function, shallow copy. Otherwise, it acts like <code>torch.tensor()</code>, deep copy. So using the function is recommended.</p>
</li>
</ul>
<h2 id="2-2-Special-tensors"><a href="#2-2-Special-tensors" class="headerlink" title="2.2 Special tensors"></a>2.2 Special tensors</h2><p>For the special tensors, PyTorch provides some common methods:</p>
<ul>
<li>Linear:</li>
</ul>
<p>We have <code>torch.linspace</code> and <code>torch.arange</code>. They are easy to understand. Please see the docs <a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/generated/torch.linspace.html#torch.linspace">linspace</a> and <a target="_blank" rel="noopener" href="https://pytorch.org/docs/stable/generated/torch.arange.html#torch.arange">arange</a>.</p>
<ul>
<li>Random:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">torch.randn(<span class="number">1</span>, <span class="number">2</span>) <span class="comment"># normal distribution, shape 1x2</span></span><br><span class="line">torch.rand(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># uniform[0, 1) distribution, shape 1x2</span></span><br><span class="line">torch.randint(<span class="number">0</span>, <span class="number">100</span>, (<span class="number">1</span>, <span class="number">2</span>)) <span class="comment"># uniform[0, 100) distribution, shape 1x2</span></span><br></pre></td></tr></table></figure>

<p>These functions also support passing in <code>torch.Size()</code> or a sequence as the size parameter. </p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = torch.randn(<span class="number">10</span>, <span class="number">10</span>) <span class="comment"># a is in shape 10x10</span></span><br><span class="line">torch.randn(a.shape)    <span class="comment"># good!</span></span><br><span class="line">torch.randn([<span class="number">10</span>, <span class="number">10</span>])   <span class="comment"># good!</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Special tensors:</li>
</ul>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">torch.zeros(<span class="number">10</span>, <span class="number">10</span>) <span class="comment"># all zero tensor, shape 10x10</span></span><br><span class="line">torch.ones(<span class="number">10</span>, <span class="number">10</span>)  <span class="comment"># all one tensor, shape 10x10</span></span><br><span class="line"><span class="comment"># By default, the dtype is float32.</span></span><br></pre></td></tr></table></figure>

<ul>
<li><code>xxx_like()</code></li>
</ul>
<p>PyTorch has a series of function looks like <code>xxx_like()</code>, such as <code>ones_like()</code>, <code>zeros_like()</code>, <code>randn_like()</code>. These functions generates the tensor with the name, and the <code>dtype</code> and <code>device</code> and <code>layout</code> is same as the passing-in tensor. </p>
<p><code>torch.rand_like(input)</code> is equivalent to <code>torch.rand(input.size(), dtype=input.dtype, layout=input.layout, device=input.device)</code>.</p>
<p>An example:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">arr = torch.tensor([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>], dtype=torch.float64)</span><br><span class="line"><span class="built_in">print</span>(arr.shape) <span class="comment"># torch.Size([3])</span></span><br><span class="line"><span class="built_in">print</span>(arr.dtype) <span class="comment"># torch.float64</span></span><br><span class="line"></span><br><span class="line">z = torch.zeros_like(arr)</span><br><span class="line"><span class="built_in">print</span>(z.shape)   <span class="comment"># torch.Size([3])</span></span><br><span class="line"><span class="built_in">print</span>(z.dtype)   <span class="comment"># torch.float64</span></span><br></pre></td></tr></table></figure>






      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/07/My-Setup-to-New-Linux-Server-Account/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/07/My-Setup-to-New-Linux-Server-Account/" class="post-title-link" itemprop="url">My Setup to New Linux Server Account</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-07 13:47:38" itemprop="dateCreated datePublished" datetime="2023-05-07T13:47:38+08:00">2023-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2024-02-01 21:23:35" itemprop="dateModified" datetime="2024-02-01T21:23:35+08:00">2024-02-01</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>In this article, I list some procedures I do when setting up new Linux server account. They’ll be helpful in the later development stages. </p>
<h1 id="1-Change-the-default-shell"><a href="#1-Change-the-default-shell" class="headerlink" title="1. Change the default shell"></a>1. Change the default shell</h1><p>This step is <strong>optional</strong>. Sometimes the default shell in the machine is merely <code>sh</code>. We can change it to other better shells like <code>bash</code>, <code>zsh</code>, for easier use. </p>
<h2 id="1-1-Show-the-current-shells"><a href="#1-1-Show-the-current-shells" class="headerlink" title="1.1 Show the current shells"></a>1.1 Show the current shells</h2><p>You can display the current shell name by either the following commands:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="variable">$0</span></span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">-bash</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$SHELL</span></span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">/bin/bash</span><br></pre></td></tr></table></figure>
<h2 id="1-2-Get-all-available-shells"><a href="#1-2-Get-all-available-shells" class="headerlink" title="1.2 Get all available shells"></a>1.2 Get all available shells</h2><p>To check what shells are installed, type the following commands:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> /etc/shells</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># /etc/shells: valid login shells</span></span><br><span class="line">/bin/sh</span><br><span class="line">/bin/bash</span><br><span class="line">/bin/rbash</span><br><span class="line">/bin/dash</span><br><span class="line">/usr/bin/tmux</span><br><span class="line">/usr/bin/screen</span><br><span class="line">/bin/zsh</span><br><span class="line">/usr/bin/zsh</span><br></pre></td></tr></table></figure>
<h2 id="1-3-Change-the-default-shell"><a href="#1-3-Change-the-default-shell" class="headerlink" title="1.3 Change the default shell"></a>1.3 Change the default shell</h2><p>Use the <code>chsh</code> (<strong>ch</strong>ange <strong>sh</strong>ell) command to change the shell, with <code>-s</code> flag:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chsh -s /bin/bash</span><br><span class="line">Password:</span><br></pre></td></tr></table></figure>
<p>Then type the password of the login account (The password is hidden, just type it, and press Enter). Finally, you can quit the shell, and restart it once. You’ll see the new shell. </p>
<h1 id="2-Install-conda"><a href="#2-Install-conda" class="headerlink" title="2. Install conda"></a>2. Install conda</h1><p>Python environment is very essential in my workflow, especially in deep learning. Please refer to the official docs:</p>
<p><a target="_blank" rel="noopener" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/linux.html">https://docs.conda.io/projects/conda/en/latest/user-guide/install/linux.html</a></p>
<h1 id="3-Setup-ssh-key-password-free-login"><a href="#3-Setup-ssh-key-password-free-login" class="headerlink" title="3. Setup ssh key (password-free login)"></a>3. Setup ssh key (password-free login)</h1><p>Modified from the blog <a target="_blank" rel="noopener" href="https://github.com/bokesyo/CSC4005_2022Fall_Demo/blob/main/docs/Instruction%20on%20Passwordlessly%20Connecting%20to%20Cluster%20by%20Setting%20Up%20SSH%20Key%20Authentification.md">here</a>.</p>
<p>(Replace <code>&#123;KeyName&#125;</code> to any name you like)</p>
<h2 id="3-1-Generate-SSH-Key-Pair-on-Your-Local-Machine"><a href="#3-1-Generate-SSH-Key-Pair-on-Your-Local-Machine" class="headerlink" title="3.1. Generate SSH Key Pair on Your Local Machine"></a>3.1. Generate SSH Key Pair on Your Local Machine</h2><p><strong>(macOS Users please do the following)</strong></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Execute the following commands on your LOCAL machine</span></span><br><span class="line"><span class="built_in">cd</span> ~/.ssh</span><br><span class="line">ssh-keygen -t rsa -b 1024 -f <span class="string">&quot;&#123;KeyName&#125;&quot;</span> -C <span class="string">&quot;&#123;Put Any Comment You Like&#125;&quot;</span></span><br><span class="line">ssh-add -K ./&#123;KeyName&#125;</span><br></pre></td></tr></table></figure>
<p>To check if you make it right, type the following command and you should see a string as the output.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/&#123;KeyName&#125;.pub</span><br></pre></td></tr></table></figure>
<p><strong>(Windows Users please do the following)</strong></p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Execute the following commands on your local machine</span></span><br><span class="line"><span class="built_in">cd</span> C:\Users\&#123;UserName&#125;\.ssh</span><br><span class="line">ssh<span class="literal">-keygen</span> <span class="literal">-t</span> rsa <span class="literal">-b</span> <span class="number">1024</span> <span class="operator">-f</span> <span class="string">&quot;&#123;KeyName&#125;&quot;</span> <span class="literal">-C</span> <span class="string">&quot;&#123;Put Any Comment You Like&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>To check if you make it right, double click the key file (<code>C:\Users\&#123;UserName&#125;\.ssh\&#123;KeyName&#125;.pub</code>) to view it and you should see a string.</p>
<p><strong>Notes:</strong></p>
<ul>
<li>The commands above are executed on your own computer, instead of the server.</li>
<li>It is fine to use the SSH key file generated before (eg. id_rsa.pub), if you have.</li>
<li>ssh-keygen will ask you to set a paraphrase, which improves the security of using SSH key authentication. Type “Enter” for no paraphrase.</li>
</ul>
<p><strong>Parameters for ssh-keygen command explanation:</strong></p>
<ul>
<li><strong>-t</strong>: type for ssh key generation. Here we use rsa</li>
<li><strong>-b</strong>: bits</li>
<li><strong>-f</strong>: name of your ssh key file. You are recommended to set this parameter in case it<br>is conflict with the ssh key file you generated before.</li>
<li><strong>-C</strong>: comments to distinguish the ssh key file from others</li>
</ul>
<h2 id="3-2-Transfer-Your-SSH-Public-Key-File-to-the-Server"><a href="#3-2-Transfer-Your-SSH-Public-Key-File-to-the-Server" class="headerlink" title="3.2. Transfer Your SSH Public Key File to the Server"></a>3.2. Transfer Your SSH Public Key File to the Server</h2><p>We use the <code>scp</code> command to transfer the <strong>public key</strong> generated in the former step to the server. </p>
<p><code>~/.ssh/&#123;KeyName&#125;.pub</code> is the public key you just generated. <code>&#123;Your Account Name&#125;@&#123;Server ip&#125;</code> is your server account name and ip address. </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Execute the following commands on your LOCAL machine</span></span><br><span class="line"><span class="comment"># (macOS)</span></span><br><span class="line">scp ~/.ssh/&#123;KeyName&#125;.pub &#123;Your Account Name&#125;@&#123;Server ip&#125;:~</span><br><span class="line"></span><br><span class="line"><span class="comment"># (windows)</span></span><br><span class="line">scp C:\Users\&#123;UserName&#125;\.ssh\&#123;KeyName&#125;.pub &#123;Your Account Name&#125;@&#123;Server ip&#125;:~</span><br></pre></td></tr></table></figure>
<p><strong>Notes:</strong></p>
<ul>
<li>This command will ask you for password for data transfer. Please make sure that you type in the correct password. If you are Windows user and you want to copy &amp; paste the password for convenience, try “Ctrl + Shift + V” if you fail to paste the password with “Ctrl + V”.</li>
</ul>
<h2 id="3-3-Configure-authorized-keys-on-the-Server"><a href="#3-3-Configure-authorized-keys-on-the-Server" class="headerlink" title="3.3. Configure authorized_keys on the Server"></a>3.3. Configure authorized_keys on the Server</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## Login the server with password. Do this step in locally to establish a ssh connection</span></span><br><span class="line">ssh &#123;Your Account Name&#125;@&#123;Server ip&#125;</span><br><span class="line"><span class="comment">## All the following commands should be executed on the ssh connection just established. (i.e., execute them on the server)</span></span><br><span class="line"><span class="built_in">mkdir</span> -p ~/.ssh</span><br><span class="line"><span class="built_in">cat</span> ./&#123;KeyName&#125;.pub &gt;&gt; ~/.ssh/authorized_keys</span><br><span class="line"><span class="built_in">rm</span> -f ~/&#123;KeyName&#125;.pub</span><br><span class="line"><span class="built_in">chmod</span> 700 ~/.ssh</span><br><span class="line"><span class="built_in">chmod</span> 600 ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure>
<p>To check if you make it right, execute the following command and you should see a string as the output that is the same as in Step-1.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cat</span> ~/.ssh/authorized_keys</span><br></pre></td></tr></table></figure></p>
<h2 id="3-4-Prepare-for-SSH-Connection-with-Key-Authentication"><a href="#3-4-Prepare-for-SSH-Connection-with-Key-Authentication" class="headerlink" title="3.4. Prepare for SSH Connection with Key Authentication"></a>3.4. Prepare for SSH Connection with Key Authentication</h2><p>Add the following content to <code>~/.ssh/config</code> (In windows, it’s <code>C:\Users\&#123;UserName&#125;\.ssh\config</code>) file on your LOCAL machine:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Host &#123;Any Name You Like&#125;</span><br><span class="line">    HostName &#123;ip&#125;</span><br><span class="line">    IdentityFile ~/.ssh/&#123;KeyName&#125;</span><br><span class="line">    User &#123;Your Account Name&#125;</span><br></pre></td></tr></table></figure><br><strong>Notes:</strong></p>
<ul>
<li>It is recommended to configure with the Remote SSH extension on VS Code. Please refer to <a target="_blank" rel="noopener" href="https://code.visualstudio.com/docs/remote/ssh">Remote Development using SSH</a> for more information.</li>
</ul>
<h2 id="3-5-Login-the-Server-Password-free-with-SSH-key-Authentication"><a href="#3-5-Login-the-Server-Password-free-with-SSH-key-Authentication" class="headerlink" title="3.5. Login the Server Password-free with SSH key Authentication"></a>3.5. Login the Server Password-free with SSH key Authentication</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;Your Account Name&#125;@&#123;Server ip&#125;</span><br></pre></td></tr></table></figure>
<p>or<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;Your Account Name&#125;@&#123;Any Name You Like&#125; <span class="comment"># above in Sec. 4</span></span><br></pre></td></tr></table></figure></p>
<p>or </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh &#123;Any Name You Like&#125; <span class="comment"># above in Sec. 4</span></span><br></pre></td></tr></table></figure>
<h1 id="4-Set-some-alias"><a href="#4-Set-some-alias" class="headerlink" title="4. Set some alias"></a>4. Set some alias</h1><p>Alias convenient us typing some common commands.</p>
<p>Add the following to the end of <code>~/.bashrc</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">alias</span> cf=<span class="string">&quot;ls -l | grep &quot;</span>^-<span class="string">&quot; | wc -l&quot;</span></span><br><span class="line"><span class="built_in">alias</span> ns=<span class="string">&quot;nvidia-smi&quot;</span></span><br><span class="line"><span class="built_in">alias</span> py=<span class="string">&quot;python&quot;</span></span><br><span class="line"><span class="built_in">alias</span> act=<span class="string">&quot;conda activate&quot;</span></span><br></pre></td></tr></table></figure>
<p>The first alias, <code>cf</code> means count files, can count number of visible files (excluding directories) under the current working directory.</p>
<p>The second alias, <code>ns</code> is short for <code>nvidia-smi</code> to check for the GPU information.</p>
<p>The third alias <code>py</code> is short for <code>python</code>.</p>
<p>The fourth alias <code>act</code> can be used like <code>act py39</code> (activate the conda <code>py39</code> environment)</p>
<h1 id="5-Configure-the-CUDA-compiler-version"><a href="#5-Configure-the-CUDA-compiler-version" class="headerlink" title="5. Configure the CUDA compiler version"></a>5. Configure the CUDA compiler version</h1><p>This step is <strong>optional</strong>. If you want to compile some PyTorch operators locally, you should set the <code>nvcc</code> version same to the PyTorch runtime version. </p>
<p>Add the following to the end of <code>~/.bashrc</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-11.1/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-11.1/lib64:<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure>
<p>Change the CUDA directory (<code>/usr/local/cuda-11.1</code> above) to the one you actually want to use. For example, the PyTorch is compiled under <code>cuda-11.3</code>, you probably want to use <code>nvcc</code> with <code>cuda-11.x</code>, but not <code>cuda-10.2</code>. </p>
<h1 id="6-bashrc-template"><a href="#6-bashrc-template" class="headerlink" title="6. ~/.bashrc template"></a>6. ~/.bashrc template</h1><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># path to some executable</span></span><br><span class="line"><span class="built_in">export</span> PATH=&lt;Your-Path-to-Some-EXE&gt;:<span class="variable">$PATH</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment"># path to cuda, change version to yours</span></span><br><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-11.1/bin:<span class="variable">$PATH</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># path to cuda libraries, change version to yours</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-11.1/lib64:<span class="variable">$LD_LIBRARY_PATH</span> </span><br><span class="line"></span><br><span class="line"><span class="comment"># path to self-defined temp directory</span></span><br><span class="line"><span class="built_in">export</span> TMPDIR=/&lt;Path-to-Temp-Dir&gt;/tmp</span><br><span class="line"><span class="comment"># path to some common visited places (shortcut)</span></span><br><span class="line"><span class="built_in">export</span> workdir=/&lt;Path-to-Common-Dir&gt;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Shortcuts</span></span><br><span class="line"><span class="built_in">alias</span> countf=<span class="string">&quot;ls -l | grep &quot;</span>^-<span class="string">&quot; | wc -l&quot;</span> <span class="comment"># count files</span></span><br><span class="line"><span class="built_in">alias</span> countd=<span class="string">&quot;ls -l | grep &quot;</span>^d<span class="string">&quot; | wc -l&quot;</span> <span class="comment"># count directories</span></span><br><span class="line"><span class="built_in">alias</span> sized=<span class="string">&quot;du -h --max-depth=1&quot;</span> <span class="comment"># size of each subdirectory</span></span><br><span class="line"><span class="built_in">alias</span> ns=<span class="string">&quot;nvidia-smi&quot;</span> </span><br><span class="line"><span class="built_in">alias</span> py=<span class="string">&quot;python&quot;</span></span><br><span class="line"><span class="built_in">alias</span> act=<span class="string">&quot;conda activate&quot;</span></span><br><span class="line"><span class="built_in">alias</span> pys=<span class="string">&quot;python setup.py install&quot;</span></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/07/Conda-common-commands/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/07/Conda-common-commands/" class="post-title-link" itemprop="url">Conda Common Commands Quick Reference</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-07 13:46:58" itemprop="dateCreated datePublished" datetime="2023-05-07T13:46:58+08:00">2023-05-07</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-09-14 11:08:49" itemprop="dateModified" datetime="2023-09-14T11:08:49+08:00">2023-09-14</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/QRH/" itemprop="url" rel="index"><span itemprop="name">QRH</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Installation"><a href="#1-Installation" class="headerlink" title="1. Installation"></a>1. Installation</h2><p>Please refer to the official <a target="_blank" rel="noopener" href="https://docs.conda.io/projects/conda/en/latest/user-guide/install/linux.html">docs</a>. </p>
<p>After installing it, we can set mirrors which facilitate download speed in China. It’s recommended to add some mirror configs (Run in command line):</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</span><br><span class="line">conda config --add channels https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/ </span><br><span class="line">conda config --<span class="built_in">set</span> show_channel_urls <span class="built_in">yes</span></span><br></pre></td></tr></table></figure>



<h2 id="2-Common-commands"><a href="#2-Common-commands" class="headerlink" title="2. Common commands"></a>2. Common commands</h2><h3 id="2-1-Create-env"><a href="#2-1-Create-env" class="headerlink" title="2.1 Create env"></a>2.1 Create env</h3><p>Create an environment with <code>&lt;env_name&gt;</code> and python with <code>3.9</code>. </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n &lt;env_name&gt; python=3.9</span><br></pre></td></tr></table></figure>

<h3 id="2-2-Activate-env"><a href="#2-2-Activate-env" class="headerlink" title="2.2 Activate env"></a>2.2 Activate env</h3><p>Activate &#x2F; Deactivate the environment <code>&lt;env_name&gt;</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># activate</span></span><br><span class="line">conda activate &lt;env_name&gt;</span><br><span class="line"><span class="comment"># deactivate</span></span><br><span class="line">conda deactivate &lt;env_name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-3-Remove-env"><a href="#2-3-Remove-env" class="headerlink" title="2.3 Remove env"></a>2.3 Remove env</h3><p>Remove the environment <code>&lt;env_name&gt;</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda remove -n &lt;env_name&gt; --all</span><br></pre></td></tr></table></figure>

<h3 id="2-4-Clone-env"><a href="#2-4-Clone-env" class="headerlink" title="2.4 Clone env"></a>2.4 Clone env</h3><p>Clone an existing environment, to a new one. So you don’t need to install package one by one. This command is a variant of <code>conda create</code>.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda create -n &lt;new_name&gt; --<span class="built_in">clone</span> &lt;old_name&gt;</span><br></pre></td></tr></table></figure>

<h3 id="2-5-Install-packages"><a href="#2-5-Install-packages" class="headerlink" title="2.5 Install packages"></a>2.5 Install packages</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># with conda</span></span><br><span class="line">conda install &lt;packages&gt;</span><br><span class="line"><span class="comment"># with pip</span></span><br><span class="line">pip install &lt;packages&gt;</span><br><span class="line"><span class="comment"># with pip and mirrors</span></span><br><span class="line">pip install &lt;packages&gt; -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br></pre></td></tr></table></figure>

<h3 id="2-6-Update-packages"><a href="#2-6-Update-packages" class="headerlink" title="2.6 Update packages"></a>2.6 Update packages</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update &lt;packages&gt;</span><br></pre></td></tr></table></figure>

<p>To update all packages, use:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda update --all</span><br></pre></td></tr></table></figure>

<h3 id="2-7-List-packages-in-env"><a href="#2-7-List-packages-in-env" class="headerlink" title="2.7 List packages in env"></a>2.7 List packages in env</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda list</span><br></pre></td></tr></table></figure>

<h3 id="2-8-List-all-envs"><a href="#2-8-List-all-envs" class="headerlink" title="2.8 List all envs"></a>2.8 List all envs</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda info --envs</span><br></pre></td></tr></table></figure>

<h3 id="2-9-Clean-caches"><a href="#2-9-Clean-caches" class="headerlink" title="2.9 Clean caches"></a>2.9 Clean caches</h3><p>The downloaded caches occupies the storage data. We may clean them by the following commands:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conda clean --all</span><br></pre></td></tr></table></figure>

<h3 id="2-10-Export-Import-env-configs"><a href="#2-10-Export-Import-env-configs" class="headerlink" title="2.10 Export &#x2F; Import env configs"></a>2.10 Export &#x2F; Import env configs</h3><p>Export the current environment configs to a yaml file, then we can follow the yaml file to create another environment.</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># change to the desired env</span></span><br><span class="line">conda activate &lt;env_name&gt;</span><br><span class="line"><span class="comment"># export </span></span><br><span class="line">conda <span class="built_in">env</span> <span class="built_in">export</span> &gt; environment.yml</span><br><span class="line"></span><br><span class="line"><span class="comment"># import and create</span></span><br><span class="line">conda <span class="built_in">env</span> create -f environment.yml</span><br><span class="line"><span class="comment"># Then, you&#x27;ll have a full environment like in environment.yml</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/06/CUDA-No-process-but-GPU-memory-occupied/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/06/CUDA-No-process-but-GPU-memory-occupied/" class="post-title-link" itemprop="url">CUDA No process found but GPU memory occupied</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-06 01:07:19" itemprop="dateCreated datePublished" datetime="2023-05-06T01:07:19+08:00">2023-05-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-27 16:43:05" itemprop="dateModified" datetime="2023-05-27T16:43:05+08:00">2023-05-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Problem-Solving/" itemprop="url" rel="index"><span itemprop="name">Problem Solving</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><p>when typing <code>nvidia-smi</code>, we find there is GPU memory occupied (See Red Boxes), but we cannot see any relevant process on that GPU (See Orange Boxes).</p>
<img src="/2023/05/06/CUDA-No-process-but-GPU-memory-occupied/problem.png" alt="problem" style="zoom:50%;">

<h2 id="Possible-Answer"><a href="#Possible-Answer" class="headerlink" title="Possible Answer"></a>Possible Answer</h2><p>This can be caused by <code>torch.distributed</code> and other multi-processing CUDA programs. When the main process terminated, the background process still alive, not killed.</p>
<ol>
<li>To figure which processes used the GPU, we can use the following command:</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fuser -v /dev/nvidia&lt;<span class="built_in">id</span>&gt;</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">                     Users     PID         Command</span><br><span class="line">/dev/nvidia5:        XXXXXX    14701 F...m python</span><br><span class="line">                     XXXXXX    14703 F...m python</span><br><span class="line">                     XXXXXX    14705 F...m python</span><br><span class="line">                     XXXXXX    14706 F...m python</span><br><span class="line">                     XXXXXX    37041 F...m python</span><br><span class="line">                     XXXXXX    37053 F...m python</span><br></pre></td></tr></table></figure>

<p>This will list all of the processes that use GPU. Note that if this is executed from a <strong>normal user</strong>, then only the user’s processes displayed. If this is executed from <strong>root</strong>, then all user’s relevant processes will be displayed.</p>
<ol start="2">
<li>Then use the following command to kill the process shown above.</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">kill</span> -9 [PID]</span><br></pre></td></tr></table></figure>

<p>That will kill the process on the GPU. After killing the processes, you will find the GPU memory is freed. If still occupied, this may be caused by other users. You need to ask other users&#x2F;administrators to kill it manually.</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/05/02/common-latex-templates/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/05/02/common-latex-templates/" class="post-title-link" itemprop="url">Common LaTeX Blocks Templates</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-05-02 16:19:21" itemprop="dateCreated datePublished" datetime="2023-05-02T16:19:21+08:00">2023-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-08-26 22:31:38" itemprop="dateModified" datetime="2023-08-26T22:31:38+08:00">2023-08-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="1-Set-geometries-boundary"><a href="#1-Set-geometries-boundary" class="headerlink" title="1. Set geometries (boundary)"></a>1. Set geometries (boundary)</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;geometry&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">\geometry</span>&#123;a4paper, top = 1.25in, bottom = 1.25in, left = 1.25in, right = 1.25in, headheight = 1.25in&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-Figures"><a href="#2-Figures" class="headerlink" title="2. Figures"></a>2. Figures</h2><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;float&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;subcaption&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;graphicx&#125; </span><br></pre></td></tr></table></figure>

<img src="/2023/05/02/common-latex-templates/figures.png" alt="figures" style="zoom:60%;">

<h3 id="2-1-Single-Figure"><a href="#2-1-Single-Figure" class="headerlink" title="2.1 Single Figure:"></a>2.1 Single Figure:</h3><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[H]</span><br><span class="line">    <span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\includegraphics</span>[width=0.35<span class="keyword">\textwidth</span>]&#123;blankfig.png&#125;</span><br><span class="line">    <span class="keyword">\caption</span>&#123;XXXXXX&#125;</span><br><span class="line">    <span class="comment">% \label&#123;XXXX&#125;</span></span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure>


<h3 id="2-2-Two-Independent-Figures-in-One-Row"><a href="#2-2-Two-Independent-Figures-in-One-Row" class="headerlink" title="2.2 Two Independent Figures in One Row"></a>2.2 Two Independent Figures in One Row</h3><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[H]<span class="comment">%[htp]</span></span><br><span class="line"><span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\begin</span>&#123;minipage&#125;[t]&#123;0.47<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">        <span class="keyword">\centering</span></span><br><span class="line">        <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\textwidth</span>]&#123;blankfig.png&#125;</span><br><span class="line">        <span class="keyword">\caption</span>&#123;XXXX&#125;</span><br><span class="line">    <span class="comment">% \label&#123;XXXX&#125;</span></span><br><span class="line">    <span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line">    <span class="keyword">\begin</span>&#123;minipage&#125;[t]&#123;0.47<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">        <span class="keyword">\centering</span></span><br><span class="line">        <span class="keyword">\includegraphics</span>[width=1<span class="keyword">\textwidth</span>]&#123;blankfig.png&#125;</span><br><span class="line">        <span class="keyword">\caption</span>&#123;XXXX&#125;</span><br><span class="line">        <span class="comment">% \label&#123;XXXX&#125;</span></span><br><span class="line">    <span class="keyword">\end</span>&#123;minipage&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure>
<h3 id="2-3-Two-Subfigures-in-One-Row"><a href="#2-3-Two-Subfigures-in-One-Row" class="headerlink" title="2.3 Two Subfigures in One Row:"></a>2.3 Two Subfigures in One Row:</h3><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;figure&#125;[H]</span><br><span class="line">     <span class="keyword">\centering</span></span><br><span class="line">     <span class="keyword">\begin</span>&#123;subfigure&#125;[b]&#123;0.47<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">         <span class="keyword">\centering</span></span><br><span class="line">         <span class="keyword">\includegraphics</span>[width=<span class="keyword">\textwidth</span>]&#123;blankfig.png&#125;</span><br><span class="line">         <span class="keyword">\caption</span>&#123;xxxx&#125;</span><br><span class="line">         <span class="comment">% \label&#123;xxxx&#125;</span></span><br><span class="line">     <span class="keyword">\end</span>&#123;subfigure&#125;</span><br><span class="line">     <span class="comment">% \hfill</span></span><br><span class="line">     <span class="keyword">\begin</span>&#123;subfigure&#125;[b]&#123;0.47<span class="keyword">\textwidth</span>&#125;</span><br><span class="line">         <span class="keyword">\centering</span></span><br><span class="line">         <span class="keyword">\includegraphics</span>[width=<span class="keyword">\textwidth</span>]&#123;blankfig.png&#125;</span><br><span class="line">         <span class="keyword">\caption</span>&#123;xxxx&#125;</span><br><span class="line">         <span class="comment">% \label&#123;xxxx&#125;</span></span><br><span class="line">     <span class="keyword">\end</span>&#123;subfigure&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">\caption</span>&#123;XXXX&#125;</span><br><span class="line">    <span class="comment">% \label&#123;xxxx&#125;</span></span><br><span class="line"><span class="keyword">\end</span>&#123;figure&#125;</span><br></pre></td></tr></table></figure>


<h2 id="3-Pseudo-codes"><a href="#3-Pseudo-codes" class="headerlink" title="3. Pseudo-codes"></a>3. Pseudo-codes</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>[ruled, vlined, linesnumbered]&#123;algorithm2e&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/05/02/common-latex-templates/pseudo-codes.png" alt="pseudo-codes" style="zoom:60%;">

<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;algorithm&#125;[H]</span><br><span class="line">	<span class="keyword">\caption</span>&#123;Residual&#x27;s Distribution Simulation&#125;</span><br><span class="line">	<span class="keyword">\BlankLine</span></span><br><span class="line">    <span class="keyword">\SetAlgoLined</span></span><br><span class="line">	<span class="keyword">\KwIn</span>&#123;Number of sample needed (<span class="built_in">$</span>num<span class="built_in">_</span>&#123;sample&#125;<span class="built_in">$</span>), <span class="built_in">$</span>w<span class="built_in">_</span>1<span class="built_in">$</span>,<span class="built_in">$</span>w<span class="built_in">_</span>2<span class="built_in">$</span>,<span class="built_in">$</span>w<span class="built_in">_</span>3<span class="built_in">$</span>,<span class="built_in">$</span><span class="keyword">\mu</span><span class="built_in">_</span>1<span class="built_in">$</span>,<span class="built_in">$</span><span class="keyword">\mu</span><span class="built_in">_</span>2<span class="built_in">$</span>,<span class="built_in">$</span><span class="keyword">\mu</span><span class="built_in">_</span>3<span class="built_in">$</span>,<span class="built_in">$</span><span class="keyword">\sigma</span><span class="built_in">_</span>1<span class="built_in">$</span>,<span class="built_in">$</span><span class="keyword">\sigma</span><span class="built_in">_</span>2<span class="built_in">$</span>,<span class="built_in">$</span><span class="keyword">\sigma</span><span class="built_in">_</span>3<span class="built_in">$</span>.&#125;</span><br><span class="line">	<span class="keyword">\KwOut</span>&#123;A sequence of random variables <span class="built_in">$</span><span class="keyword">\&#123;</span>X<span class="built_in">_</span>i<span class="keyword">\&#125;</span><span class="built_in">_</span>&#123;i = 1&#125;<span class="built_in">^</span>&#123;num<span class="built_in">_</span>&#123;sample&#125;&#125;<span class="built_in">$</span> following target distribution.&#125; </span><br><span class="line"></span><br><span class="line">	<span class="keyword">\BlankLine</span></span><br><span class="line">    i = 0<span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\While</span>&#123;<span class="built_in">$</span> i &lt; num<span class="built_in">_</span>&#123;sample&#125; <span class="built_in">$</span>&#125;&#123;</span><br><span class="line">        <span class="built_in">$</span>v<span class="built_in">_</span>i<span class="built_in">$</span> <span class="built_in">$</span><span class="keyword">\sim</span> <span class="keyword">\mathcal</span>&#123;U&#125;[0,1]<span class="built_in">$</span><span class="keyword">\\</span></span><br><span class="line">        <span class="keyword">\uIf</span>&#123;<span class="built_in">$</span>0&lt;v<span class="built_in">_</span>i <span class="keyword">\leq</span> w<span class="built_in">_</span>1<span class="built_in">$</span>&#125;&#123;</span><br><span class="line">            <span class="built_in">$</span>X<span class="built_in">_</span>i <span class="keyword">\sim</span> <span class="keyword">\mathcal</span>&#123;N&#125;(<span class="keyword">\mu</span><span class="built_in">_</span>1,<span class="keyword">\sigma</span><span class="built_in">_</span>1<span class="built_in">^</span>2)<span class="built_in">$</span> <span class="keyword">\;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">\uElseIf</span>&#123;<span class="built_in">$</span>w<span class="built_in">_</span>1&lt;v<span class="built_in">_</span>i<span class="keyword">\leq</span> w<span class="built_in">_</span>2<span class="built_in">$</span>&#125;&#123;</span><br><span class="line">            <span class="built_in">$</span>X<span class="built_in">_</span>i <span class="keyword">\sim</span> <span class="keyword">\mathcal</span>&#123;N&#125;(<span class="keyword">\mu</span><span class="built_in">_</span>2,<span class="keyword">\sigma</span><span class="built_in">_</span>2<span class="built_in">^</span>2)<span class="built_in">$</span> <span class="keyword">\;</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">\Else</span>&#123;</span><br><span class="line">            <span class="built_in">$</span>X<span class="built_in">_</span>i <span class="keyword">\sim</span> <span class="keyword">\mathcal</span>&#123;N&#125;(<span class="keyword">\mu</span><span class="built_in">_</span>3,<span class="keyword">\sigma</span><span class="built_in">_</span>3<span class="built_in">^</span>2)<span class="built_in">$</span> <span class="keyword">\;</span></span><br><span class="line">        &#125;</span><br><span class="line">        i = i + 1</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">\Return</span>&#123;<span class="built_in">$</span><span class="keyword">\&#123;</span>X<span class="built_in">_</span>i<span class="keyword">\&#125;</span><span class="built_in">_</span>&#123;i = 1&#125;<span class="built_in">^</span>&#123;num<span class="built_in">_</span>&#123;sample&#125;&#125;<span class="built_in">$</span>    &#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">\BlankLine</span></span><br><span class="line"><span class="keyword">\end</span>&#123;algorithm&#125;</span><br></pre></td></tr></table></figure>



<h2 id="4-Tables"><a href="#4-Tables" class="headerlink" title="4. Tables"></a>4. Tables</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;tabularx&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;booktabs&#125;</span><br><span class="line"><span class="keyword">\usepackage</span>&#123;threeparttable&#125;</span><br></pre></td></tr></table></figure>

<img src="/2023/05/02/common-latex-templates/tables.png" alt="tables" style="zoom:60%;">

<h3 id="4-1-Narrow-table"><a href="#4-1-Narrow-table" class="headerlink" title="4.1 Narrow table"></a>4.1 Narrow table</h3><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[H]</span><br><span class="line">    <span class="keyword">\centering</span><span class="keyword">\small</span></span><br><span class="line">    <span class="keyword">\setlength</span>&#123;<span class="keyword">\tabcolsep</span>&#125;&#123;3mm&#125;&#123;</span><br><span class="line">        <span class="keyword">\caption</span>&#123;XXXX&#125;</span><br><span class="line">        <span class="keyword">\begin</span>&#123;tabular&#125;&#123;cccc&#125;</span><br><span class="line">            <span class="keyword">\specialrule</span>&#123;0.05em&#125;&#123;3pt&#125;&#123;3pt&#125;</span><br><span class="line">            <span class="keyword">\toprule</span></span><br><span class="line">            X <span class="built_in">&amp;</span> X <span class="built_in">&amp;</span> X <span class="built_in">&amp;</span> X  <span class="keyword">\\</span></span><br><span class="line">            <span class="keyword">\midrule</span></span><br><span class="line">            XXX <span class="built_in">&amp;</span> 0.928 <span class="built_in">&amp;</span> 0.2935 <span class="built_in">&amp;</span> 1.000 <span class="keyword">\\</span></span><br><span class="line">            XXX <span class="built_in">&amp;</span> 0.747 <span class="built_in">&amp;</span> 0.0526 <span class="built_in">&amp;</span> 1.301 <span class="keyword">\\</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">\specialrule</span>&#123;0.05em&#125;&#123;3pt&#125;&#123;3pt&#125; </span><br><span class="line">        <span class="keyword">\bottomrule</span></span><br><span class="line">        <span class="keyword">\label</span>&#123;tab:compare2&#125;</span><br><span class="line">    	<span class="keyword">\end</span>&#123;tabular&#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-2-Text-width-table"><a href="#4-2-Text-width-table" class="headerlink" title="4.2 Text-width table"></a>4.2 Text-width table</h3><p>The width may be adjusted manually.</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[H]</span><br><span class="line"><span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\caption</span>&#123;Experiment results for different &quot;joins&quot;&#125;</span><br><span class="line">    <span class="keyword">\label</span>&#123;X&#125;</span><br><span class="line">    <span class="keyword">\begin</span>&#123;tabularx&#125;&#123;<span class="keyword">\textwidth</span>&#125;&#123;X X X&#125;</span><br><span class="line">    <span class="keyword">\toprule</span></span><br><span class="line">    Header 1 <span class="built_in">&amp;</span> Header 2 <span class="built_in">&amp;</span> Header 3 <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\midrule</span></span><br><span class="line">    Data 1   <span class="built_in">&amp;</span> Data 2   <span class="built_in">&amp;</span> Data 3   <span class="keyword">\\</span></span><br><span class="line">    Data 4   <span class="built_in">&amp;</span> Data 5   <span class="built_in">&amp;</span> Data 6   <span class="keyword">\\</span></span><br><span class="line">    <span class="keyword">\bottomrule</span></span><br><span class="line">    <span class="keyword">\end</span>&#123;tabularx&#125;</span><br><span class="line">    </span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure>

<h3 id="4-3-With-Footnote"><a href="#4-3-With-Footnote" class="headerlink" title="4.3 With Footnote"></a>4.3 With Footnote</h3><figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\begin</span>&#123;table&#125;[htb]</span><br><span class="line"><span class="keyword">\centering</span></span><br><span class="line">    <span class="keyword">\caption</span>&#123;Final experiment results.&#125;</span><br><span class="line">    <span class="keyword">\label</span>&#123;Table:finalresults&#125;</span><br><span class="line">    <span class="keyword">\begin</span>&#123;tabularx&#125;&#123;<span class="keyword">\textwidth</span>&#125;&#123;X X X&#125;</span><br><span class="line">        <span class="keyword">\toprule</span></span><br><span class="line">        Header 1<span class="built_in">$</span><span class="built_in">^</span>a<span class="built_in">$</span> <span class="built_in">&amp;</span> Header 2 <span class="built_in">&amp;</span> Header 3 <span class="keyword">\\</span></span><br><span class="line">        <span class="keyword">\midrule</span></span><br><span class="line">        Data 1   <span class="built_in">&amp;</span> Data 2<span class="built_in">$</span><span class="built_in">^</span>b<span class="built_in">$</span>   <span class="built_in">&amp;</span> Data 3   <span class="keyword">\\</span></span><br><span class="line">        Data 4   <span class="built_in">&amp;</span> Data 5   <span class="built_in">&amp;</span> Data 6<span class="built_in">$</span><span class="built_in">^</span>c<span class="built_in">$</span>   <span class="keyword">\\</span></span><br><span class="line">        <span class="keyword">\bottomrule</span></span><br><span class="line">    <span class="keyword">\end</span>&#123;tabularx&#125;</span><br><span class="line">    <span class="keyword">\begin</span>&#123;tablenotes&#125;</span><br><span class="line">    <span class="keyword">\item</span>[1]  <span class="keyword">\scriptsize</span> a. Footnote a.</span><br><span class="line">    <span class="keyword">\item</span>[2]  <span class="keyword">\scriptsize</span> b. Footnote b. </span><br><span class="line">    <span class="keyword">\item</span>[3]  <span class="keyword">\scriptsize</span> c. Footnote c. </span><br><span class="line">    <span class="keyword">\end</span>&#123;tablenotes&#125;</span><br><span class="line"><span class="keyword">\vspace</span>&#123;-1.25em&#125;</span><br><span class="line"><span class="keyword">\end</span>&#123;table&#125;</span><br></pre></td></tr></table></figure>



<h2 id="5-Listing-Code-blocks"><a href="#5-Listing-Code-blocks" class="headerlink" title="5. Listing (Code blocks)"></a>5. Listing (Code blocks)</h2><figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\usepackage</span>&#123;listings&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-1-SQL-Style-Setting"><a href="#5-1-SQL-Style-Setting" class="headerlink" title="5.1 SQL Style Setting"></a>5.1 SQL Style Setting</h3><img src="/2023/05/02/common-latex-templates/listings.png" alt="listings" style="zoom:60%;">

<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% outside of document</span></span><br><span class="line"><span class="keyword">\lstset</span>&#123;</span><br><span class="line">    language=SQL,    </span><br><span class="line">    basicstyle = <span class="keyword">\tiny</span><span class="keyword">\ttfamily</span>,</span><br><span class="line">    breaklines=true,</span><br><span class="line">    numberstyle=<span class="keyword">\tiny</span>,keywordstyle=<span class="keyword">\color</span>&#123;blue!70&#125;,</span><br><span class="line">    commentstyle=<span class="keyword">\color</span>&#123;red!50!green!50!blue!50&#125;,frame=shadowbox,</span><br><span class="line">    columns=flexible,</span><br><span class="line">    rulesepcolor=<span class="keyword">\color</span>&#123;red!20!green!20!blue!20&#125;,basicstyle=<span class="keyword">\ttfamily</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">% inside of document</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;lstlisting&#125;</span><br><span class="line">    SELECT u.province, c.chip<span class="built_in">_</span>name AS ChipName, SUM(p.budget) AS revenue</span><br><span class="line">    FROM user AS u NATURAL JOIN package AS p, chip AS c</span><br><span class="line">    WHERE p.package<span class="built_in">_</span>id=c.package<span class="built_in">_</span>id AND province IN (<span class="comment">%s)</span></span><br><span class="line">    GROUP BY c.chip<span class="built_in">_</span>name</span><br><span class="line">    ORDER BY SUM(p.budget) DESC; </span><br><span class="line"><span class="keyword">\end</span>&#123;lstlisting&#125;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-Python-Style-Setting"><a href="#5-2-Python-Style-Setting" class="headerlink" title="5.2 Python Style Setting"></a>5.2 Python Style Setting</h3><img src="/2023/05/02/common-latex-templates/listing2.png" alt="listing2" style="zoom:60%;">

<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">% outside of document</span></span><br><span class="line"><span class="keyword">\lstset</span>&#123;</span><br><span class="line">  language=Python,</span><br><span class="line">  basicstyle=<span class="keyword">\small</span><span class="keyword">\ttfamily</span>,</span><br><span class="line">  commentstyle=<span class="keyword">\color</span>&#123;gray&#125;,</span><br><span class="line">  keywordstyle=<span class="keyword">\color</span>&#123;blue&#125;<span class="keyword">\bfseries</span>,</span><br><span class="line">  stringstyle=<span class="keyword">\color</span>&#123;red&#125;,</span><br><span class="line">  showstringspaces=false,</span><br><span class="line">  numbers=left,</span><br><span class="line">  numberstyle=<span class="keyword">\tiny</span><span class="keyword">\color</span>&#123;gray&#125;,</span><br><span class="line">  stepnumber=1,</span><br><span class="line">  numbersep=10pt,</span><br><span class="line">  tabsize=4,</span><br><span class="line">  showspaces=false,</span><br><span class="line">  showtabs=false,</span><br><span class="line">  breaklines=true,</span><br><span class="line">  breakatwhitespace=true,</span><br><span class="line">  aboveskip=<span class="keyword">\bigskipamount</span>,</span><br><span class="line">  belowskip=<span class="keyword">\bigskipamount</span>,</span><br><span class="line">  frame=single</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">% inside of document</span></span><br><span class="line"><span class="keyword">\begin</span>&#123;lstlisting&#125;</span><br><span class="line">    print(&quot;hello world!&quot;)</span><br><span class="line">    for qid in range(hs.shape[0]):</span><br><span class="line">    if qid &lt; 1:</span><br><span class="line">        lvl = 0</span><br><span class="line">    elif qid &gt;= 1 and qid &lt; 3:</span><br><span class="line">        lvl = 1</span><br><span class="line">    elif qid &gt;= 3 and qid &lt; 6:</span><br><span class="line">        lvl = 2</span><br><span class="line">    elif qid &gt;= 6 and qid &lt; 11:</span><br><span class="line">        lvl = 3</span><br><span class="line"><span class="keyword">\end</span>&#123;lstlisting&#125;</span><br></pre></td></tr></table></figure>








      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/27/pytorch-C-packages-installation-failed-problems/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/27/pytorch-C-packages-installation-failed-problems/" class="post-title-link" itemprop="url">Pytorch C packages CUDA Installation Mismatch Problems</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-27 10:10:13" itemprop="dateCreated datePublished" datetime="2023-04-27T10:10:13+08:00">2023-04-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-27 16:43:07" itemprop="dateModified" datetime="2023-05-27T16:43:07+08:00">2023-05-27</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Problem-Solving/" itemprop="url" rel="index"><span itemprop="name">Problem Solving</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>When installing some non-pip installed packages, especially in the deep learning field, we may use <code>python setup.py build install</code> to build the packages locally. Then, some typical problems may happen in this stage. An CUDA mismatch error may be:</p>
<p><img src="/2023/04/27/pytorch-C-packages-installation-failed-problems/problem.png" alt="problem"></p>
<p>This error can be caused for many reasons. I just report my situation and how do I solve it. </p>
<h2 id="Why-this-happen"><a href="#Why-this-happen" class="headerlink" title="Why this happen?"></a>Why this happen?</h2><p>Some packages need to be compiled by the local CUDA compilers and to be installed locally. Then, those packages cooperate with the pytorch in the conda environment. Therefore, they need to be a compiled with the same version (at least same major version, like <code>cuda 11.x</code>) CUDA compilers. </p>
<ul>
<li>First, we inspect the conda environment’s pytorch’s CUDA version by:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> torch</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>torch.version.cuda</span><br><span class="line"><span class="string">&#x27;11.3&#x27;</span></span><br></pre></td></tr></table></figure>

<p>This means that our pytorch is compiled by cuda <code>11.3</code>. (Same as the error message above!)</p>
<ul>
<li>Then, we inspect the system’s CUDA compiler version by:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2019 NVIDIA Corporation</span><br><span class="line">Built on Wed_Oct_23_19:24:38_PDT_2019</span><br><span class="line">Cuda compilation tools, release 10.2, V10.2.89</span><br></pre></td></tr></table></figure>

<p>This means that our system’s current CUDA version is <code>10.2</code>. (Same as the error message above!)</p>
<p>Therefore, the compiler version going to compile the package is NOT consistent with the compiler compiled pytorch. The Error is reported.</p>
<h2 id="How-to-solve-it"><a href="#How-to-solve-it" class="headerlink" title="How to solve it?"></a>How to solve it?</h2><p>So to solve this problem, the easiest way is to install a new CUDA with corresponding version. (In my test, I don’t need to install an exact <code>11.3</code> version, only an <code>11.1</code> version is OK)</p>
<ol>
<li>Install the CUDA with specific version. Many installation tutorials can be found online (skipped)</li>
<li>Export the new path in <code>~/.bashrc</code>: Add following command at the end of <code>~/.bashrc</code>:</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-&lt;YOUR VERSION&gt;/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-&lt;YOUR VERSION&gt;/lib64:<span class="variable">$&#123;LD_LIBRARY_PATH&#125;</span></span><br></pre></td></tr></table></figure>

<p>(Remember to change &lt;YOUR VERSION&gt; above to your CUDA version!!)</p>
<ol start="3">
<li>Open a new terminal, type in:</li>
</ol>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">nvcc: NVIDIA (R) Cuda compiler driver</span><br><span class="line">Copyright (c) 2005-2020 NVIDIA Corporation</span><br><span class="line">Built on Mon_Oct_12_20:09:46_PDT_2020</span><br><span class="line">Cuda compilation tools, release 11.1, V11.1.105</span><br><span class="line">Build cuda_11.1.TC455_06.29190527_0</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>Then it should work! Go to the installation directory, and then switch to the target conda environment, and install!</li>
</ol>
<h2 id="Common-techniques-for-debugging"><a href="#Common-techniques-for-debugging" class="headerlink" title="Common techniques for debugging"></a>Common techniques for debugging</h2><ul>
<li>Inspecting the pytorch’s CUDA version:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> torch</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>torch.version.cuda</span><br><span class="line"><span class="string">&#x27;11.3&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Inspecting the system’s CUDA compiler version:</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nvcc -V</span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> torch.utils.cpp_extension <span class="keyword">import</span> CUDA_HOME</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>CUDA_HOME</span><br><span class="line"><span class="string">&#x27;/usr/local/cuda-11.1&#x27;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>Change the <code>$PATH</code> variable, so the new CUDA can be found:</li>
</ul>
<p>Add following command at the end of <code>~/.bashrc</code>:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=/usr/local/cuda-11.1/bin:<span class="variable">$PATH</span></span><br><span class="line"><span class="built_in">export</span> LD_LIBRARY_PATH=/usr/local/cuda-11.1/lib64:<span class="variable">$LD_LIBRARY_PATH</span></span><br></pre></td></tr></table></figure>

<p>REMEMBER to change the CUDA version to your version.</p>
<ul>
<li>Delete the cached installing data</li>
</ul>
<p>In some situation, when we modified the compiler, we shall build the package from scratch. </p>
<p><strong>Remove</strong> any of the build, cached, dist, temp directory! E.g., the <code>build</code> and <code>DCNv3.egg-info</code> and <code>dist</code> directory below.</p>
<img src="/2023/04/27/pytorch-C-packages-installation-failed-problems/package.png" alt="package" style="zoom:60%;"> 

<p>(But be careful that don’t remove the source code!!!)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/04/04/signal-system-with-python/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/04/04/signal-system-with-python/" class="post-title-link" itemprop="url">signal system with python</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-04-04 13:39:02" itemprop="dateCreated datePublished" datetime="2023-04-04T13:39:02+08:00">2023-04-04</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/30/collate-fn-and-zip/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/30/collate-fn-and-zip/" class="post-title-link" itemprop="url">PyTorch collate_fn and Python zip function</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2023-03-30 23:56:28" itemprop="dateCreated datePublished" datetime="2023-03-30T23:56:28+08:00">2023-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2023-05-29 11:27:31" itemprop="dateModified" datetime="2023-05-29T11:27:31+08:00">2023-05-29</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Deep-Learning/" itemprop="url" rel="index"><span itemprop="name">Deep Learning</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Part of the article is generated by [ChatGPT]</p>
<h2 id="collate-fn"><a href="#collate-fn" class="headerlink" title="collate_fn"></a>collate_fn</h2><p>This post records about the <code>collate_fn</code> from <code>torch.util.data.DataLoader</code> and the python built-in function <code>zip</code>. </p>
<p>Each batch, the dataloader collects <code>batch_size</code> number of items. They are picked from the dataset one by one. So currently, the batch data is <code>[(data1, target1), (data2, target2), ..., (dataN, targetN)]</code>. </p>
<p>The default <code>collate_fn</code> would change it into <code>[torch.tensor([data1, data2, ..., dataN]), torch.tensor([target1, target2, ..., targetN])]</code>. </p>
<p>However, in some NLP tasks, the data is not in the same length. So we need to apply <code>torch.nn.utils.rnn.pad_sequence</code> to make each data same length (usually the maximum length in this batch). A typical implementation is:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">collate_fn_train</span>(<span class="params">batch</span>):</span><br><span class="line">    x, y = <span class="built_in">zip</span>(*batch)</span><br><span class="line">    x_pad = pad_sequence(x, batch_first=<span class="literal">True</span>)</span><br><span class="line">    <span class="comment"># y = torch.Tensor(y) # optional</span></span><br><span class="line">    <span class="keyword">return</span> x_pad, y</span><br></pre></td></tr></table></figure>



<h2 id="zip-and"><a href="#zip-and" class="headerlink" title="zip and *"></a>zip and *</h2><ul>
<li>What does the <code>zip</code> do in the above function?</li>
</ul>
<p>The <code>zip()</code> function in Python is a built-in function that takes one or more iterables (such as lists, tuples, or strings) and “zips” them together, returning an iterator of tuples where the i-th tuple contains the i-th element from each of the input iterables.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line">c = [<span class="literal">True</span>, <span class="literal">False</span>, <span class="literal">True</span>]</span><br><span class="line"></span><br><span class="line">zipped = <span class="built_in">zip</span>(a, b, c)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">list</span>(zipped))</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line">[(<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="literal">True</span>), (<span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>, <span class="literal">False</span>), (<span class="number">3</span>, <span class="string">&#x27;c&#x27;</span>, <span class="literal">True</span>)]</span><br></pre></td></tr></table></figure>

<ul>
<li>What is the <code>*</code>?</li>
</ul>
<p>In Python, the asterisk (*) symbol can be used to unpack iterables like lists or tuples. When used in this way, the asterisk is sometimes called the “splat” operator or the “unpacking” operator. The unpacking operator is used to extract the individual elements from an iterable and assign them to separate variables.</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">my_list = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="built_in">print</span>(*my_list)</span><br><span class="line"><span class="comment"># equals</span></span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment"># OUTPUT</span></span><br><span class="line"><span class="number">1</span> <span class="number">2</span> <span class="number">3</span></span><br></pre></td></tr></table></figure>

<ul>
<li>So, what is the <code>x, y = zip(*batch)</code>?</li>
</ul>
<p>First, <code>batch</code> is <code>[(data1, target1), (data2, target2), ..., (dataN, targetN)]</code>.</p>
<p><code>*batch</code> would unpack the outmost list, to be <code>zip((data1, target1), (data2, target2), ..., (dataN, targetN))</code>. The result would be two tuples, <code>[data1, data2, ..., dataN]</code> and <code>[target1, target2, ..., targetN]</code>. The former one is assigned to <code>x</code> and the other is assigned to <code>y</code>.</p>
<p>In this way, we get separate data structure, that contains all <code>data</code> and <code>target</code> respectively.  </p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/30/dict-to-latex-md/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/30/dict-to-latex-md/" class="post-title-link" itemprop="url">Convert Python Dictionary to Source Code of Latex and Markdown</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-03-30 17:13:32 / Modified: 23:57:22" itemprop="dateCreated datePublished" datetime="2023-03-30T17:13:32+08:00">2023-03-30</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>The code is generated by [ChatGPT].</p>
<p>Here are two common functions, that can convert the python built-in dictionary into the format of latex&#x2F;markdown unnumbered list, so that we can copy it into the latex&#x2F;markdown. Example can be:</p>
<p>The input python dictionary is:</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">my_dict = &#123;</span><br><span class="line">    <span class="string">&quot;fruits&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;apples&quot;</span>: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">        <span class="string">&quot;bananas&quot;</span>: <span class="string">&quot;yellow&quot;</span>,</span><br><span class="line">        <span class="string">&quot;grapes&quot;</span>: <span class="string">&quot;purple&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;vegetables&quot;</span>: &#123;</span><br><span class="line">        <span class="string">&quot;carrots&quot;</span>: <span class="string">&quot;orange&quot;</span>,</span><br><span class="line">        <span class="string">&quot;spinach&quot;</span>: <span class="string">&quot;green&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="string">&quot;meat&quot;</span>: <span class="string">&quot;beef&quot;</span>,</span><br><span class="line">    <span class="string">&quot;dairy&quot;</span>: <span class="string">&quot;milk&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>The result for markdown is:</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> fruits</span><br><span class="line"><span class="bullet">  -</span> apples</span><br><span class="line"><span class="bullet">  -</span> bananas</span><br><span class="line"><span class="bullet">  -</span> grapes</span><br><span class="line"><span class="bullet">-</span> vegetables</span><br><span class="line"><span class="bullet">  -</span> carrots</span><br><span class="line"><span class="bullet">  -</span> spinach</span><br><span class="line"><span class="bullet">-</span> meat</span><br><span class="line"><span class="bullet">  -</span> beef</span><br><span class="line"><span class="bullet">-</span> dairy</span><br><span class="line"><span class="bullet">  -</span> milk</span><br></pre></td></tr></table></figure>

<p>and result for LaTeX is:</p>
<figure class="highlight latex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">\item</span> fruits</span><br><span class="line"><span class="keyword">\begin</span>&#123;itemize&#125;</span><br><span class="line">  <span class="keyword">\item</span> apples: red</span><br><span class="line">  <span class="keyword">\item</span> bananas: yellow</span><br><span class="line">  <span class="keyword">\item</span> grapes: purple</span><br><span class="line"><span class="keyword">\end</span>&#123;itemize&#125;</span><br><span class="line"><span class="keyword">\item</span> vegetables</span><br><span class="line"><span class="keyword">\begin</span>&#123;itemize&#125;</span><br><span class="line">  <span class="keyword">\item</span> carrots: orange</span><br><span class="line">  <span class="keyword">\item</span> spinach: green</span><br><span class="line"><span class="keyword">\end</span>&#123;itemize&#125;</span><br><span class="line"><span class="keyword">\item</span> meat: beef</span><br><span class="line"><span class="keyword">\item</span> dairy: milk</span><br></pre></td></tr></table></figure>



<p>Function explanation: it is as simple as it shows. We use the recursion strategy here. When we are going to print a sub-dictionary, we recursively call the function, with more (two) spaces indented.</p>
<h2 id="Dict-to-latex-unnumbered-list"><a href="#Dict-to-latex-unnumbered-list" class="headerlink" title="Dict to latex unnumbered list"></a>Dict to latex unnumbered list</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dict_to_latex</span>(<span class="params">d, level=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Converts a dictionary to a string in LaTeX format for an unnumbered list.</span></span><br><span class="line"><span class="string">    Nested dictionaries are considered as second level items.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    - d (dict): The dictionary to be converted.</span></span><br><span class="line"><span class="string">    - level (int): The current nesting level (defaults to 0).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    - A string in LaTeX format for an unnumbered list.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    latex_str = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(k, <span class="built_in">str</span>):</span><br><span class="line">            k = k.replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\_&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(v, <span class="built_in">str</span>):</span><br><span class="line">            v = v.replace(<span class="string">&#x27;_&#x27;</span>, <span class="string">&#x27;\_&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">            latex_str += <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;  &#x27;</span>*level&#125;</span>\\item <span class="subst">&#123;k&#125;</span>\n\\begin&#123;&#123;itemize&#125;&#125;\n<span class="subst">&#123;dict_to_latex(v, level+<span class="number">1</span>)&#125;</span>\\end&#123;&#123;itemize&#125;&#125;\n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            latex_str += <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;  &#x27;</span>*level&#125;</span>\\item <span class="subst">&#123;k&#125;</span>: <span class="subst">&#123;v&#125;</span>\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> latex_str</span><br></pre></td></tr></table></figure>

<p>Note that we should avoid the <code>_</code> in our string. So we need first convert it into escape character, <code>\_</code>.</p>
<p>The result of the string should be wrapped by a <code>\begin&#123;itemize&#125; \end&#123;itemize&#125;</code>.</p>
<h2 id="Dict-to-markdown-unnumbered-list"><a href="#Dict-to-markdown-unnumbered-list" class="headerlink" title="Dict to markdown unnumbered list"></a>Dict to markdown unnumbered list</h2><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">dict_to_markdown</span>(<span class="params">d, level=<span class="number">0</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    Converts a dictionary to a string in Markdown format for an unnumbered list.</span></span><br><span class="line"><span class="string">    Nested dictionaries are considered as second level items.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Args:</span></span><br><span class="line"><span class="string">    - d (dict): The dictionary to be converted.</span></span><br><span class="line"><span class="string">    - level (int): The current nesting level (defaults to 0).</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    Returns:</span></span><br><span class="line"><span class="string">    - A string in Markdown format for an unnumbered list.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    md_str = <span class="string">&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> d.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(v, <span class="built_in">dict</span>):</span><br><span class="line">            md_str += <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;  &#x27;</span>*level&#125;</span>- <span class="subst">&#123;k&#125;</span>\n<span class="subst">&#123;dict_to_markdown(v, level+<span class="number">1</span>)&#125;</span>&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            md_str += <span class="string">f&quot;<span class="subst">&#123;<span class="string">&#x27;  &#x27;</span>*level&#125;</span>- <span class="subst">&#123;k&#125;</span>: <span class="subst">&#123;v&#125;</span>\n&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> md_str</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2023/03/24/cpp-declare-2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Future">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Future's blog">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2023/03/24/cpp-declare-2/" class="post-title-link" itemprop="url">C/C++ 复杂类型声明规则（2）-识读const关键字</a>
        </h2>

        <div class="post-meta">
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2023-03-24 11:56:36 / Modified: 12:30:02" itemprop="dateCreated datePublished" datetime="2023-03-24T11:56:36+08:00">2023-03-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Techniques/" itemprop="url" rel="index"><span itemprop="name">Techniques</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>“C&#x2F;C++ 复杂类型声明规则” 将分为两节。第一节介绍螺旋法则声明规范，第二节介绍const的修饰关系。</p>
<p>本节主要解决以下问题：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> *a;  <span class="comment">// a可变嘛? *a可变嘛?</span></span><br><span class="line"><span class="type">int</span> * <span class="type">const</span> a; <span class="comment">// a可变嘛? *a可变嘛?</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> * <span class="type">const</span> a; <span class="comment">// a可变嘛? *a可变嘛?</span></span><br></pre></td></tr></table></figure>

<p>这两节内容，我都尝试以一种不用死记硬背，而是理解的方式去掌握。</p>
<p>本文参考自【初中生也能看懂的C&#x2F;C++类型声明规则教学，很简单的！】 <a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1mB4y1L7HB/">https://www.bilibili.com/video/BV1mB4y1L7HB/</a> 。里面通过一些例子介绍了螺旋法则和对const关键词的判读。我将在此基础上加上我对其的解释，使其变得更加通俗易懂。</p>
<p>基本解决思路：<strong>const 只修饰右边最近的东西。</strong></p>
<p>例如<code>const r</code>, 说明<code>r</code>这个变量是const的，不能动。<code>const *r</code>，意为<code>const (*r)</code>，说明<code>*r</code>，r指向的东西，是const的。r自身可以变化。</p>
<p>再例如，<code>const int r</code>, 说明这个int是const的。这个整数是常量。<code>r</code>是一个整型常量。</p>
<p>举一些例子：</p>
<h3 id="例子1"><a href="#例子1" class="headerlink" title="例子1"></a>例子1</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="type">const</span> a1 = <span class="number">5</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> a2 = <span class="number">6</span>;</span><br></pre></td></tr></table></figure>

<p>在这里，两个其实是等价的。对于第一个，<code>a1</code>被const修饰了，所以<code>a1</code>不能变。<code>a1</code>是一个整型变量。所以连起来，<code>a1</code>是一个常量整型变量。对于第二个，可以理解成<code>a2</code>是一个const int，<code>a2</code>是一个常量整型变量。</p>
<p><strong>所以，不同的声明形式，意义可能相同。</strong></p>
<h3 id="例子2"><a href="#例子2" class="headerlink" title="例子2"></a>例子2</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="type">const</span> *p1 = &amp;a1;</span><br><span class="line"><span class="type">const</span> <span class="type">int</span> *p2 = &amp;a1;</span><br></pre></td></tr></table></figure>

<p>在这里，两个其实也是等价的。对于第一个，<code>*p1</code>被const修饰了，所以<code>*p1</code>不能变。即<code>p1</code>指向的是一个整型常量。对于第二个，可以理解成<code>p2</code>指向一个const int，<code>p2</code>指向的是一个常量整型变量。对于这两个来说，<code>p1</code> <code>p2</code>自己可以变，但是他们指向的不能变。</p>
<p><strong>一个声明里的多个const，意义可能相同。例如：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> <span class="type">const</span> *p3</span><br></pre></td></tr></table></figure>

<p>这个例子里虽然有两个const，但其实还是只修饰了一个<code>*p3</code>。<code>p3</code>自身没有被const修饰，可以变。</p>
<h3 id="例子3"><a href="#例子3" class="headerlink" title="例子3"></a>例子3</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> *<span class="type">const</span> r2;</span><br></pre></td></tr></table></figure>

<p>在这里，<code>r2</code>直接被const修饰，所以<code>r2</code>不能变。<code>r2</code>指向一个int，那个int没有额外修饰，所以那个int是可以变的。总之，<code>r2</code>是不能变的，但是<code>r2</code>指向的int是可以变的。</p>
<h3 id="例子4"><a href="#例子4" class="headerlink" title="例子4"></a>例子4</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> *<span class="type">const</span> r3;</span><br></pre></td></tr></table></figure>

<p>在这里，<code>r3</code>直接被const修饰，所以<code>r3</code>不能变。<code>r3</code>指向一个const int，那个int没有额外修饰，所以那个int是可以变的。总之，<code>r3</code>是不能变的，<code>r3</code>指向的int也不可以变的。</p>
<h3 id="例子5"><a href="#例子5" class="headerlink" title="例子5"></a>例子5</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> **r5;</span><br></pre></td></tr></table></figure>

<p><code>r5</code>指向一个指向int的指针。这个被指向的指针指向的int是被const所修饰的。所以<code>r5</code>可以变，<code>r5</code>指向的那个（指向int的指针）也是可以变的，但是<code>r5</code>指向的指针指向的int没得变。</p>
<h3 id="例子6"><a href="#例子6" class="headerlink" title="例子6"></a>例子6</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="type">const</span> * <span class="type">const</span> * <span class="type">const</span> r6;</span><br></pre></td></tr></table></figure>

<p>上面那个例子的升级版。<code>r6</code>指向一个指向int的指针。<code>r6</code>被const修饰，<code>r6</code>不能变。<code>r6</code>指向的（指向int的指针）被const修饰，即<code>*r6</code>不能变。<code>r6</code>指向的指针指向的int，<code>**r6</code>也被const修饰，也不能变。</p>
<h3 id><a href="#" class="headerlink" title></a></h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Future</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">35</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Future</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3/dist/jquery.fancybox.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
